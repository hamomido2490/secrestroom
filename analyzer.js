// analyzer.js - إصدار مُعمّق وطويل، يبدأ بلون الشخصية

import personalityQuestions from './questions.js';

function generatePersonalityAnalysis(answers, userData) {
  const { age, gender } = userData;

  // حساب لون الشخصية
  const colorCount = { red: 0, yellow: 0, green: 0, blue: 0 };
  answers.forEach((answerIndex, questionIndex) => {
    const option = personalityQuestions[questionIndex]?.options[answerIndex];
    if (!option) return;

    if (option.text.includes('أحمر') || option.trait.includes('D')) colorCount.red++;
    if (option.text.includes('أصفر') || option.trait.includes('I')) colorCount.yellow++;
    if (option.text.includes('أخضر') || option.trait.includes('S')) colorCount.green++;
    if (option.text.includes('أزرق') || option.trait.includes('C')) colorCount.blue++;
  });

  let dominantColor = 'green';
  let max = 0;
  for (const [color, count] of Object.entries(colorCount)) {
    if (count > max) {
      max = count;
      dominantColor = color;
    }
  }

  // تعريف الألوان
  const colorProfiles = {
    red: {
      name: "النوع الأحمر",
      title: "القائد الطموح",
      traits: [
        "حازم",
        "طموح",
        "مباشر",
        "محب للنتائج",
        "واثق من قراراته",
        "لا يهاب التحدي"
      ],
      description: `
أنت من النوع الذي لا ينتظر الفرصة، بل يصنعها.  
فيك قوة دفع داخلية لا تتوقف، ورغبة عميقة في التحكم في مصيرك.  
أنت لا تهرب من المسؤولية، بل تطلبها — لأنك تعرف أنك قادر على صنع الفارق.

القرارات الحاسمة تخرج منك بسرعة، ليس لأنك متسرع، بل لأنك تثق بحدسك وخبرتك.  
تحب أن ترى النتائج بوضوح، والوقت الضائع يشعرك بالإحباط.  
لكنك لست قاسيًا، بل صريح — تُقدّر الصدق أكثر من المجاملة.

في المواقف الصعبة، أنت أول من يقف في المقدمة.  
لست بحاجة إلى تصفيق، لكنك تعرف قيمتك.  
النجاح بالنسبة لك ليس ترفًا، بل ضرورة.

أنت تُحدث تغييرًا ليس لأنه مطلوب، بل لأنه واجب.
      `.trim()
    },
    yellow: {
      name: "النوع الأصفر",
      title: "المحفّز المرح",
      traits: [
        "اجتماعي",
        "متفائل",
        "مبدع",
        "حيوي",
        "محب للإلهام"
      ],
      description: `
أنت شرارة الضوء في أي مكان تدخله.  
طاقتك لا تنضب، وابتسامتك معدية.  
أنت لا ترى العقبات كما يراها الآخرون، بل تراها فرصة لإثبات أن المستحيل ممكن.

تحب أن تكون محط الأنظار، ليس من أجل الغرور، بل لأنك تشعر بالحياة عندما تُلهم الآخرين.  
أنت تفكر خارج الصندوق، وتحب أن تكسر الروتين.  
القيود تُثبّطك، أما الحرية فتُطلق إبداعك.

العلاقات بالنسبة لك ليست مجرد تواصل، بل تبادل للطاقة.  
أنت تُحيي من حولك، وتجعل المهام العادية تبدو كمغامرات.  
قد يراك البعض غير جاد، لكنهم لا يعلمون أنك جاد جدًا في الحفاظ على البهجة.

أنت تُحدث تغييرًا ليس بالقوة، بل بالحماس.
      `.trim()
    },
    green: {
      name: "النوع الأخضر",
      title: "الداعم المستقر",
      traits: [
        "ودود",
        "صبور",
        "متعاون",
        "مُستمع جيد",
        "يحافظ على الانسجام"
      ],
      description: `
أنت القلب الهادئ في وسط العاصفة.  
لا تُسرع، لكنك لا تتوقف.  
أنت تبني الثقة ببطء، لكنها تدوم مدى الحياة.

الصراع يُرهقك، لكنك لا تهرب منه — بل تسعى لتسوية الأمور بهدوء.  
أنت لا تبحث عن التقدير، لكنك تستحقه أكثر من غيرك.  
أنت من يُكمل الفريق، من يُشعر الآخرين بالأمان.

تحب الاستقرار، ليس لأنك خائف من التغيير، بل لأنك تعرف قيمته.  
أنت تُخطط بقلبك قبل عقلك، وتحدد أولوياتك حسب من يحبونك ويحتاجونك.

أنت لا تقود بالصراخ، بل بالقدوة.  
لا تُظهر كل ما تشعر به، لكن من يعرفك جيدًا يعلم أن في داخلك بحرًا من العطاء.

أنت تُحدث تغييرًا بصمت، لكن أثرك يدوم.
      `.trim()
    },
    blue: {
      name: "النوع الأزرق",
      title: "المُخطط الدقيق",
      traits: [
        "منطقي",
        "محلل",
        "منظم",
        "يسعى للدقة",
        "يفكر قبل أن يتصرف"
      ],
      description: `
أنت لا تُسرع، لأنك تعرف أن الخطأ الواحد قد يُكلّف الكثير.  
أنت تُفكّر بعمق، تُحلّل بتركيز، وتحب أن تفهم "لماذا" قبل أن تفعل "كيف".

العشوائية تُربكك، أما النظام فيعطيك شعورًا بالأمان.  
أنت لا تُعجب بالانطباع الأول، بل بالأساس المتين.  
تحب أن تعرف كل التفاصيل، ليس من باب التفتيش، بل من باب المسؤولية.

أنت تبحث عن المعنى وراء الأشياء، عن القاعدة الكامنة وراء السلوك.  
العلاقات عندك ليست عاطفية فقط، بل يجب أن تكون منطقية أيضًا.  
قد يراك البعض باردًا، لكنك ببساطة تحترم العقل بقدر احترامك للقلب.

أنت تُحدث تغييرًا ليس بالحماس، بل بالرؤية.
      `.trim()
    }
  };

  const profile = colorProfiles[dominantColor];

  // تحليل العمر
  let ageInsight = "";
  if (age === '13-18') {
    ageInsight = "أنت في مرحلة بناء الهوية، حيث تبحث عن نفسك ومكانك في العالم. كل سؤال تطرحه على ذاتك اليوم يُشكّل الأساس لما ستكون عليه غدًا.";
  } else if (age === '19-25') {
    ageInsight = "أنت في عمر الحميمية، حيث تبحث عن علاقات حقيقية، وارتباطات عميقة. قلبك يسأل: من سيفهمني حقًا؟";
  } else if (age === '26-35' || age === '36-45') {
    ageInsight = "أنت في مرحلة الإنجابية، حيث لا يكفي أن تنجح أنت، بل أن تُسهم في نجاح الآخرين. أنت تبني، تُعلّم، وتُشارك.";
  } else if (age === '46-60' || age === '60+') {
    ageInsight = "أنت في مرحلة التقييم، حيث تنظر إلى رحلة حياتك بعين الحكيم. السؤال لم يعد 'ماذا أنجزت؟' بل 'ماذا عنيت؟'";
  }

  // تحليل جنسي
  let genderInsight = "";
  if (gender === 'أنثى') {
    genderInsight = "كأنثى، تُظهر قوة داخلية نادرة: التوازن بين القلب والعقل. أنت تُعطي دون أن تفقد ذاتك، وتدعم دون أن تذلّ نفسك.";
  } else if (gender === 'ذكر') {
    genderInsight = "كذكر، تحمل مسؤولية القيادة بثقلها وضوءها. أنت لا تهرب من التحدي، بل تراه فرصة لإثبات أن القوة الحقيقية تأتي من الداخل.";
  } else {
    genderInsight = "أنت تتجاوز التصنيفات، وتُظهر توازنًا نادرًا بين الحدس والمنطق، بين العاطفة والتحليل.";
  }

  // === التقرير النهائي ===
  const analysis = `
${profile.name}
${"=".repeat(profile.name.length + 1)}

${profile.description}

أبرز صفاتك القوية:
${profile.traits.map(trait => `• ${trait}`).join('\n')}

${ageInsight ? `\nملاحظة حسب مرحلتك العمرية:\n${ageInsight}` : ""}

${genderInsight ? `\nملاحظة حسب هويتك:\n${genderInsight}` : ""}

خلاصة:
--------
أنت شخصية فريدة، لكن لونك النفسي المسيطر هو **${profile.name}**، وهذا لا يُقيّدك، بل يُظهر نمطك المفضل في التفكير، التفاعل، والوجود.  
أنت لا تتبع القواعد، بل تُعيد تعريفها.  
وأنت لا تُبحث عن النجاح، بل عن المعنى.

${ageInsight ? "وكلما تقدّمت في رحلتك، زاد وعيك بذاتك." : "وأنت الآن في لحظة مهمة من رحلتك — لحظة الفهم."}

---

المصادر النفسية المستخدمة في التحليل:
- نظرية الألوان الشخصية
- نظرية MBTI (مايرز-بريجز)
- نظرية كيرسي للنُظم النفسية
- نظرية DISC للسلوك البشري
- نظرية العوامل الخمسة الكبرى (Big Five)
- نظرية أدلر (الشعور بالنقص والسعي للتفوق)
- نظرية ماسلو (هرم الحاجات)
- نظرية روجرز (التحقق الذاتي)
- نظرية إريكسون (المراحل النفسية الاجتماعية)
- نظرية PERMA (مكونات الرفاهية النفسية)
- نظرية الانغماس (Flow) - ميهل يتشينتنهامي

تم إعداد هذا التقرير بعناية من قِبل: غرفة الأسرار | Chamber of Secrets
  `.trim();

  return analysis;
}

export default generatePersonalityAnalysis;
