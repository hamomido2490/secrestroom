<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غرفة الأسرار | Chamber of Secrets</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100% );
            min-height: 100vh;
        }
        .gradient-text {
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-btn {
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
        }
        .option-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-2px);
        }
        .option-btn.selected {
            background: rgba(251, 191, 36, 0.2);
            border-color: #fbbf24;
            color: #fbbf24;
        }
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #fbbf24);
            transition: width 0.5s ease;
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #fbbf24, #ef4444);
            color: #1e293b;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            animation: toastSlide 0.4s ease forwards;
        }
        @keyframes toastSlide {
            to { opacity: 1; }
        }
        .zodiac-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .partner-card {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(251, 191, 36, 0.1));
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        .compatibility-score {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ec4899, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        @media print {
            body { background: white !important; color: black !important; }
            .glass-card { background: white !important; border: 1px solid #ccc !important; }
        }
    </style>
</head>
<body class="text-white">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl"></div>
    <script>
        // ===== TRANSLATIONS =====
        const translations = {
            ar: {
                welcome_title: "مرحباً بك في غرفة الأسرار",
                user_info_title: "معلوماتك الشخصية",
                user_info_desc: "دعنا نتعرف عليك أكثر لنقدم لك تحليلاً دقيقاً",
                age_label: "العمر",
                gender_label: "الجنس",
                dob_label: "تاريخ الميلاد",
                submit_user_info: "التالي",
                intro_title: "استعد لرحلة اكتشاف الذات",
                intro_subtitle: "تحليل شخصيتك ومعرفة رفيق دربك",
                intro_desc: "ستخوض رحلة من 20 سؤالاً مصممة خصيصاً لكشف أعماق شخصيتك",
                intro_p1: "سنحلل شخصيتك وفقاً لأحدث النظريات النفسية",
                intro_p2: "وسنساعدك في اكتشاف الشريك المثالي لك",
                start_btn: "ابدأ الرحلة",
                progress: "التقدم:",
                next_btn: "التالي",
                final_results_btn: "عرض النتائج",
                restart_btn: "ابدأ من جديد",
                share_btn: "مشاركة النتيجة",
                copy_btn: "نسخ النتيجة",
                zodiac_title: "اعرف برجك",
                partner_title: "رفيق دربك",
                zodiac_intro: "برجك هو",
                zodiac_daily: "اليوم:",
                zodiac_weekly: "هذا الأسبوع:",
                zodiac_yearly: "هذا العام:",
                zodiac_hint: "الأبراج مجرد تسلية، الأهم هو شخصيتك الحقيقية",
                alert_missing_fields: "يرجى ملء جميع الحقول",
                alert_invalid_dob: "تاريخ ميلاد غير صحيح",
                alert_no_answer: "يرجى اختيار إجابة",
                alert_copied: "تم نسخ النتيجة بنجاح!",
                footer1: "غرفة الأسرار - اكتشف شخصيتك الحقيقية",
                footer2: "مطور بحب ❤️ لمساعدتك في فهم نفسك أكثر",
                male: "ذكر",
                female: "أنثى",
                other: "آخر",
                compatibility_title: "نسبة التوافق",
                partner_traits: "صفات الشريك المثالي",
                relationship_advice: "نصائح للعلاقة",
                analysis_intro: "بعد تحليل إجاباتك، تم تحديد طبيعة شخصيتك على النحو التالي:",
                personality_section: "تحليل شخصيتك",
                zodiac_section: "برجك الفلكي",
                partner_section: "الشريك المثالي لك",
                partner_analysis_title: "تحليل مفصل للشريك المثالي",
                // Questions
                q1: "عندما تستيقظ في الصباح، ما أول شيء يخطر ببالك؟",
                o1_1: "أنا متحمس لأبدأ يومي!",
                o1_2: "هل كل شيء تحت السيطرة؟",
                o1_3: "هل سأكون كافيًا اليوم؟",
                o1_4: "أريد أن أفهم معنى هذا اليوم",
                q2: "في لقاء اجتماعي جديد، ماذا تفعل؟",
                o2_1: "أبدأ الحديث مع الجميع بسرعة",
                o2_2: "أراقب أولًا ثم أتحدث مع شخص واحد",
                o2_3: "أركز على من يمكن أن يفيدني أو أفيد منه",
                o2_4: "أحاول فهم مشاعر الآخرين بسرعة",
                q3: "ما نوع المهمة التي تجعلك 'تُنسى' من نفسك؟",
                o3_1: "التحديات السريعة والملتزمة بالوقت",
                o3_2: "التحليل العميق للبيانات أو الأنظمة",
                o3_3: "مساعدة شخص على تجاوز أزمة",
                o3_4: "تنظيم فريق لتحقيق هدف منظم",
                q4: "ما أكثر شيء تبحث عنه في الصداقات؟",
                o4_1: "المرح والطاقة",
                o4_2: "الولاء والاستقرار",
                o4_3: "العمق والمعنى",
                o4_4: "التحدي الفكري",
                q5: "كيف تتعامل مع الأخطاء؟",
                o5_1: "أتعلم وأتحرك بسرعة",
                o5_2: "أحلل ما حدث بدقة",
                o5_3: "أشعر بالذنب، لكنني أسامح نفسي",
                o5_4: "أتساءل: هل هذا يثبت أنني غير كافٍ؟",
                q6: "ما الذي يُشعرك بالفخر؟",
                o6_1: "تحقيق نتائج ملموسة",
                o6_2: "دعم شخص في أزمة",
                o6_3: "ابتكار فكرة جديدة",
                o6_4: "الالتزام بالواجبات والمسؤوليات",
                q7: "ما الذي تبحث عنه في قرار مهم؟",
                o7_1: "السرعة والنتائج",
                o7_2: "الإلهام والانطباع الأول",
                o7_3: "استقرار الفريق والعلاقات",
                o7_4: "التحليل العميق والمنطق",
                q8: "ماذا تفعل عندما تشعر بالضغط؟",
                o8_1: "أتحدى الموقف مباشرة",
                o8_2: "أبحث عن دعم من الآخرين",
                o8_3: "أبتعد مؤقتًا لأعيد التفكير",
                o8_4: "أحلل المشكلة من كل الزوايا",
                q9: "ما نوع الكتب أو المحتوى الذي تفضله؟",
                o9_1: "قصص نجاح، قيادة، تأثير",
                o9_2: "روايات، فلسفة، تأملات وجودية",
                o9_3: "نكت، فيديوهات مضحكة، ترفيه",
                o9_4: "أدلة عملية، خطوات، تقنيات",
                q10: "ما الذي يعطيك إحساسًا بالمعنى؟",
                o10_1: "تحقيق إنجازات كبيرة",
                o10_2: "خدمة الآخرين",
                o10_3: "فهم الكون أو النظام الكوني",
                o10_4: "الاستقرار والانتماء",
                q11: "كم مرة تغير رأيك بناءً على معلومة جديدة؟",
                o11_1: "نادرًا، أنا واثق من قراراتي",
                o11_2: "أحيانًا، إذا كانت الحجة قوية",
                o11_3: "غالبًا، لأنني أحب التعلم",
                o11_4: "دائمًا، لأنني أكره التصلب",
                q12: "ما الذي يُشعرك بالراحة؟",
                o12_1: "تحقيق الهدف",
                o12_2: "الضحك والتفاعل",
                o12_3: "الهدوء والاستقرار",
                o12_4: "النظام والفهم الكامل",
                q13: "ما هو شعارك في الحياة؟",
                o13_1: "النتيجة أهم من الطريقة",
                o13_2: "الحياة للمرح والتجربة",
                o13_3: "العلاقات تُبنى بالصبر والوفاء",
                o13_4: "الفهم يسبق كل شيء",
                q14: "كيف تتعامل مع الانتقاد؟",
                o14_1: "أتحداه وأثبت نفسي",
                o14_2: "أضحك وأحوله إلى نكتة",
                o14_3: "أتألم لكنني أسامح",
                o14_4: "أحلله بمنطق وعقل",
                q15: "ما الذي يُشعرك بالخوف؟",
                o15_1: "الفشل وعدم التحكم",
                o15_2: "الوحدة والرفض",
                o15_3: "الصراع والانفصال",
                o15_4: "الغموض وعدم الفهم",
                q16: "ما نوع القيادة التي تفضلها؟",
                o16_1: "قيادة حاسمة وسريعة",
                o16_2: "قيادة ملهمة ومحفزة",
                o16_3: "قيادة داعمة ومستقرة",
                o16_4: "قيادة منظمة وتحليلية",
                q17: "ما الذي يُشعرك بالحرية؟",
                o17_1: "التحكم في مصيري",
                o17_2: "التعبير عن نفسي بحرية",
                o17_3: "العيش بسلام مع نفسي",
                o17_4: "الفهم العميق للعالم",
                q18: "كيف تتعامل مع التغيير؟",
                o18_1: "أتحداه وأقوده",
                o18_2: "أحتفل به وانغمس فيه",
                o18_3: "أتأقلم ببطء وحذر",
                o18_4: "أحلله وأفهمه أولًا",
                q19: "ما الذي يحفزك للاستمرار؟",
                o19_1: "تحقيق أهدافي الشخصية",
                o19_2: "إسعاد الآخرين ورؤيتهم يبتسمون",
                o19_3: "الحفاظ على الاستقرار والأمان",
                o19_4: "فهم الحقيقة والوصول للكمال",
                q20: "ما هو أسلوبك في حل المشاكل؟",
                o20_1: "أتخذ قرارات سريعة وأتحمل المسؤولية",
                o20_2: "أبحث عن آراء الآخرين وأبني حلول جماعية",
                o20_3: "أتأنى وأفكر في تأثير الحل على الجميع",
                o20_4: "أبحث وأحلل حتى أجد الحل الأمثل"
            },
            en: {
                welcome_title: "Welcome to Chamber of Secrets",
                user_info_title: "Your Personal Information",
                user_info_desc: "Let us get to know you better for accurate analysis",
                age_label: "Age",
                gender_label: "Gender",
                dob_label: "Date of Birth",
                submit_user_info: "Next",
                intro_title: "Prepare for Self-Discovery Journey",
                intro_subtitle: "Analyze your personality and find your life partner",
                intro_desc: "You'll embark on a journey of 20 questions designed to reveal your personality depths",
                intro_p1: "We'll analyze your personality according to the latest psychological theories",
                intro_p2: "And help you discover your ideal partner",
                start_btn: "Start Journey",
                progress: "Progress:",
                next_btn: "Next",
                final_results_btn: "Show Results",
                restart_btn: "Start Over",
                share_btn: "Share Result",
                copy_btn: "Copy Result",
                zodiac_title: "Know Your Sign",
                partner_title: "Life Partner",
                zodiac_intro: "Your sign is",
                zodiac_daily: "Today:",
                zodiac_weekly: "This week:",
                zodiac_yearly: "This year:",
                zodiac_hint: "Zodiac signs are just for fun, what matters is your real personality",
                alert_missing_fields: "Please fill all fields",
                alert_invalid_dob: "Invalid birth date",
                alert_no_answer: "Please select an answer",
                alert_copied: "Result copied successfully!",
                footer1: "Chamber of Secrets - Discover Your True Personality",
                footer2: "Developed with love ❤️ to help you understand yourself better",
                male: "Male",
                female: "Female",
                other: "Other",
                compatibility_title: "Compatibility Score",
                partner_traits: "Ideal Partner Traits",
                relationship_advice: "Relationship Advice",
                analysis_intro: "Based on your answers, here's a detailed analysis of your personality:",
                personality_section: "Your Personality",
                zodiac_section: "Your Zodiac Sign",
                partner_section: "Your Ideal Partner",
                partner_analysis_title: "Detailed Partner Analysis",
                // English Questions
                q1: "When you wake up in the morning, what's the first thing on your mind?",
                o1_1: "I'm excited to start my day!",
                o1_2: "Is everything under control?",
                o1_3: "Will I be enough today?",
                o1_4: "I want to understand the meaning of this day.",
                q2: "In a new social gathering, what do you do?",
                o2_1: "I quickly start talking to everyone.",
                o2_2: "I observe first, then talk to one person.",
                o2_3: "I focus on who can benefit me or whom I can benefit.",
                o2_4: "I try to quickly understand others' feelings.",
                q3: "What kind of task makes you 'lose yourself'?",
                o3_1: "Fast-paced, time-bound challenges.",
                o3_2: "Deep analysis of data or systems.",
                o3_3: "Helping someone through a crisis.",
                o3_4: "Organizing a team to achieve a structured goal.",
                q4: "What do you look for most in friendships?",
                o4_1: "Fun and energy.",
                o4_2: "Loyalty and stability.",
                o4_3: "Depth and meaning.",
                o4_4: "Intellectual challenge.",
                q5: "How do you handle mistakes?",
                o5_1: "I learn and move on quickly.",
                o5_2: "I analyze what happened in detail.",
                o5_3: "I feel guilty, but I forgive myself.",
                o5_4: "I wonder: does this prove I'm not good enough?",
                q6: "What makes you feel proud?",
                o6_1: "Achieving tangible results.",
                o6_2: "Supporting someone in a crisis.",
                o6_3: "Innovating a new idea.",
                o6_4: "Sticking to duties and responsibilities.",
                q7: "What do you look for in an important decision?",
                o7_1: "Speed and results.",
                o7_2: "Inspiration and first impression.",
                o7_3: "Team stability and relationships.",
                o7_4: "Deep analysis and logic.",
                q8: "What do you do when you feel stressed?",
                o8_1: "I confront the situation directly.",
                o8_2: "I seek support from others.",
                o8_3: "I step back temporarily to rethink.",
                o8_4: "I analyze the problem from all angles.",
                q9: "What kind of books or content do you prefer?",
                o9_1: "Success stories, leadership, influence.",
                o9_2: "Novels, philosophy, existential thoughts.",
                o9_3: "Jokes, funny videos, entertainment.",
                o9_4: "Practical guides, how-tos, techniques.",
                q10: "What gives you a sense of meaning?",
                o10_1: "Achieving great accomplishments.",
                o10_2: "Serving others.",
                o10_3: "Understanding the universe or a cosmic system.",
                o10_4: "Stability and belonging.",
                q11: "How often do you change your mind based on new information?",
                o11_1: "Rarely, I'm confident in my decisions.",
                o11_2: "Sometimes, if the argument is strong.",
                o11_3: "Often, because I love to learn.",
                o11_4: "Always, because I hate being rigid.",
                q12: "What makes you feel comfortable?",
                o12_1: "Achieving a goal.",
                o12_2: "Laughter and interaction.",
                o12_3: "Calm and stability.",
                o12_4: "Order and complete understanding.",
                q13: "What is your motto in life?",
                o13_1: "The result is more important than the method.",
                o13_2: "Life is for fun and experience.",
                o13_3: "Relationships are built with patience and loyalty.",
                o13_4: "Understanding precedes everything.",
                q14: "How do you handle criticism?",
                o14_1: "I challenge it and prove myself.",
                o14_2: "I laugh and turn it into a joke.",
                o14_3: "It hurts, but I forgive.",
                o14_4: "I analyze it logically and rationally.",
                q15: "What makes you feel afraid?",
                o15_1: "Failure and lack of control.",
                o15_2: "Loneliness and rejection.",
                o15_3: "Conflict and separation.",
                o15_4: "Ambiguity and lack of understanding.",
                q16: "What type of leadership do you prefer?",
                o16_1: "Decisive and fast-paced leadership.",
                o16_2: "Inspiring and motivating leadership.",
                o16_3: "Supportive and stable leadership.",
                o16_4: "Organized and analytical leadership.",
                q17: "What makes you feel free?",
                o17_1: "Controlling my own destiny.",
                o17_2: "Expressing myself freely.",
                o17_3: "Living in peace with myself.",
                o17_4: "Deep understanding of the world.",
                q18: "How do you deal with change?",
                o18_1: "I challenge and lead it.",
                o18_2: "I celebrate and immerse myself in it.",
                o18_3: "I adapt slowly and cautiously.",
                o18_4: "I analyze and understand it first.",
                q19: "What motivates you to keep going?",
                o19_1: "Achieving my personal goals.",
                o19_2: "Making others happy and seeing them smile.",
                o19_3: "Maintaining stability and security.",
                o19_4: "Understanding the truth and reaching perfection.",
                q20: "What is your problem-solving style?",
                o20_1: "I make quick decisions and take responsibility.",
                o20_2: "I seek others' opinions and build collective solutions.",
                o20_3: "I take my time and consider the impact on everyone.",
                o20_4: "I research and analyze until I find the optimal solution."
            }
        };

        // ===== QUESTIONS (20 كاملة) =====
        const questions = {
            ar: [
                { id: 1, text: translations.ar.q1, options: [ { text: translations.ar.o1_1, trait: "I", score: 4 }, { text: translations.ar.o1_2, trait: "C", score: 3 }, { text: translations.ar.o1_3, trait: "S", score: 2 }, { text: translations.ar.o1_4, trait: "C", score: 3 } ] },
                { id: 2, text: translations.ar.q2, options: [ { text: translations.ar.o2_1, trait: "I", score: 4 }, { text: translations.ar.o2_2, trait: "S", score: 4 }, { text: translations.ar.o2_3, trait: "D", score: 3 }, { text: translations.ar.o2_4, trait: "S", score: 4 } ] },
                { id: 3, text: translations.ar.q3, options: [ { text: translations.ar.o3_1, trait: "D", score: 4 }, { text: translations.ar.o3_2, trait: "C", score: 4 }, { text: translations.ar.o3_3, trait: "S", score: 4 }, { text: translations.ar.o3_4, trait: "I", score: 3 } ] },
                { id: 4, text: translations.ar.q4, options: [ { text: translations.ar.o4_1, trait: "I", score: 4 }, { text: translations.ar.o4_2, trait: "S", score: 4 }, { text: translations.ar.o4_3, trait: "C", score: 4 }, { text: translations.ar.o4_4, trait: "D", score: 3 } ] },
                { id: 5, text: translations.ar.q5, options: [ { text: translations.ar.o5_1, trait: "D", score: 4 }, { text: translations.ar.o5_2, trait: "C", score: 4 }, { text: translations.ar.o5_3, trait: "S", score: 3 }, { text: translations.ar.o5_4, trait: "S", score: 2 } ] },
                { id: 6, text: translations.ar.q6, options: [ { text: translations.ar.o6_1, trait: "D", score: 4 }, { text: translations.ar.o6_2, trait: "S", score: 4 }, { text: translations.ar.o6_3, trait: "I", score: 4 }, { text: translations.ar.o6_4, trait: "C", score: 3 } ] },
                { id: 7, text: translations.ar.q7, options: [ { text: translations.ar.o7_1, trait: "D", score: 4 }, { text: translations.ar.o7_2, trait: "I", score: 3 }, { text: translations.ar.o7_3, trait: "S", score: 4 }, { text: translations.ar.o7_4, trait: "C", score: 4 } ] },
                { id: 8, text: translations.ar.q8, options: [ { text: translations.ar.o8_1, trait: "D", score: 4 }, { text: translations.ar.o8_2, trait: "I", score: 3 }, { text: translations.ar.o8_3, trait: "S", score: 3 }, { text: translations.ar.o8_4, trait: "C", score: 4 } ] },
                { id: 9, text: translations.ar.q9, options: [ { text: translations.ar.o9_1, trait: "D", score: 4 }, { text: translations.ar.o9_2, trait: "C", score: 4 }, { text: translations.ar.o9_3, trait: "I", score: 3 }, { text: translations.ar.o9_4, trait: "S", score: 3 } ] },
                { id: 10, text: translations.ar.q10, options: [ { text: translations.ar.o10_1, trait: "D", score: 4 }, { text: translations.ar.o10_2, trait: "S", score: 4 }, { text: translations.ar.o10_3, trait: "C", score: 4 }, { text: translations.ar.o10_4, trait: "S", score: 3 } ] },
                { id: 11, text: translations.ar.q11, options: [ { text: translations.ar.o11_1, trait: "D", score: 4 }, { text: translations.ar.o11_2, trait: "C", score: 4 }, { text: translations.ar.o11_3, trait: "I", score: 4 }, { text: translations.ar.o11_4, trait: "I", score: 3 } ] },
                { id: 12, text: translations.ar.q12, options: [ { text: translations.ar.o12_1, trait: "D", score: 4 }, { text: translations.ar.o12_2, trait: "I", score: 4 }, { text: translations.ar.o12_3, trait: "S", score: 4 }, { text: translations.ar.o12_4, trait: "C", score: 4 } ] },
                { id: 13, text: translations.ar.q13, options: [ { text: translations.ar.o13_1, trait: "D", score: 4 }, { text: translations.ar.o13_2, trait: "I", score: 4 }, { text: translations.ar.o13_3, trait: "S", score: 4 }, { text: translations.ar.o13_4, trait: "C", score: 4 } ] },
                { id: 14, text: translations.ar.q14, options: [ { text: translations.ar.o14_1, trait: "D", score: 4 }, { text: translations.ar.o14_2, trait: "I", score: 3 }, { text: translations.ar.o14_3, trait: "S", score: 3 }, { text: translations.ar.o14_4, trait: "C", score: 4 } ] },
                { id: 15, text: translations.ar.q15, options: [ { text: translations.ar.o15_1, trait: "D", score: 3 }, { text: translations.ar.o15_2, trait: "I", score: 3 }, { text: translations.ar.o15_3, trait: "S", score: 3 }, { text: translations.ar.o15_4, trait: "C", score: 3 } ] },
                { id: 16, text: translations.ar.q16, options: [ { text: translations.ar.o16_1, trait: "D", score: 4 }, { text: translations.ar.o16_2, trait: "I", score: 4 }, { text: translations.ar.o16_3, trait: "S", score: 4 }, { text: translations.ar.o16_4, trait: "C", score: 4 } ] },
                { id: 17, text: translations.ar.q17, options: [ { text: translations.ar.o17_1, trait: "D", score: 4 }, { text: translations.ar.o17_2, trait: "
// ... (تكملة من النقطة التي توقفنا عندها)
                { id: 17, text: translations.ar.q17, options: [ { text: translations.ar.o17_1, trait: "D", score: 4 }, { text: translations.ar.o17_2, trait: "I", score: 4 }, { text: translations.ar.o17_3, trait: "S", score: 4 }, { text: translations.ar.o17_4, trait: "C", score: 4 } ] },
                { id: 18, text: translations.ar.q18, options: [ { text: translations.ar.o18_1, trait: "D", score: 4 }, { text: translations.ar.o18_2, trait: "I", score: 4 }, { text: translations.ar.o18_3, trait: "S", score: 3 }, { text: translations.ar.o18_4, trait: "C", score: 4 } ] },
                { id: 19, text: translations.ar.q19, options: [ { text: translations.ar.o19_1, trait: "D", score: 4 }, { text: translations.ar.o19_2, trait: "I", score: 4 }, { text: translations.ar.o19_3, trait: "S", score: 4 }, { text: translations.ar.o19_4, trait: "C", score: 4 } ] },
                { id: 20, text: translations.ar.q20, options: [ { text: translations.ar.o20_1, trait: "D", score: 4 }, { text: translations.ar.o20_2, trait: "I", score: 4 }, { text: translations.ar.o20_3, trait: "S", score: 4 }, { text: translations.ar.o20_4, trait: "C", score: 4 } ] }
            ],
            en: [
                { id: 1, text: translations.en.q1, options: [ { text: translations.en.o1_1, trait: "I", score: 4 }, { text: translations.en.o1_2, trait: "C", score: 3 }, { text: translations.en.o1_3, trait: "S", score: 2 }, { text: translations.en.o1_4, trait: "C", score: 3 } ] },
                { id: 2, text: translations.en.q2, options: [ { text: translations.en.o2_1, trait: "I", score: 4 }, { text: translations.en.o2_2, trait: "S", score: 4 }, { text: translations.en.o2_3, trait: "D", score: 3 }, { text: translations.en.o2_4, trait: "S", score: 4 } ] },
                { id: 3, text: translations.en.q3, options: [ { text: translations.en.o3_1, trait: "D", score: 4 }, { text: translations.en.o3_2, trait: "C", score: 4 }, { text: translations.en.o3_3, trait: "S", score: 4 }, { text: translations.en.o3_4, trait: "I", score: 3 } ] },
                { id: 4, text: translations.en.q4, options: [ { text: translations.en.o4_1, trait: "I", score: 4 }, { text: translations.en.o4_2, trait: "S", score: 4 }, { text: translations.en.o4_3, trait: "C", score: 4 }, { text: translations.en.o4_4, trait: "D", score: 3 } ] },
                { id: 5, text: translations.en.q5, options: [ { text: translations.en.o5_1, trait: "D", score: 4 }, { text: translations.en.o5_2, trait: "C", score: 4 }, { text: translations.en.o5_3, trait: "S", score: 3 }, { text: translations.en.o5_4, trait: "S", score: 2 } ] },
                { id: 6, text: translations.en.q6, options: [ { text: translations.en.o6_1, trait: "D", score: 4 }, { text: translations.en.o6_2, trait: "S", score: 4 }, { text: translations.en.o6_3, trait: "I", score: 4 }, { text: translations.en.o6_4, trait: "C", score: 3 } ] },
                { id: 7, text: translations.en.q7, options: [ { text: translations.en.o7_1, trait: "D", score: 4 }, { text: translations.en.o7_2, trait: "I", score: 3 }, { text: translations.en.o7_3, trait: "S", score: 4 }, { text: translations.en.o7_4, trait: "C", score: 4 } ] },
                { id: 8, text: translations.en.q8, options: [ { text: translations.en.o8_1, trait: "D", score: 4 }, { text: translations.en.o8_2, trait: "I", score: 3 }, { text: translations.en.o8_3, trait: "S", score: 3 }, { text: translations.en.o8_4, trait: "C", score: 4 } ] },
                { id: 9, text: translations.en.q9, options: [ { text: translations.en.o9_1, trait: "D", score: 4 }, { text: translations.en.o9_2, trait: "C", score: 4 }, { text: translations.en.o9_3, trait: "I", score: 3 }, { text: translations.en.o9_4, trait: "S", score: 3 } ] },
                { id: 10, text: translations.en.q10, options: [ { text: translations.en.o10_1, trait: "D", score: 4 }, { text: translations.en.o10_2, trait: "S", score: 4 }, { text: translations.en.o10_3, trait: "C", score: 4 }, { text: translations.en.o10_4, trait: "S", score: 3 } ] },
                { id: 11, text: translations.en.q11, options: [ { text: translations.en.o11_1, trait: "D", score: 4 }, { text: translations.en.o11_2, trait: "C", score: 4 }, { text: translations.en.o11_3, trait: "I", score: 4 }, { text: translations.en.o11_4, trait: "I", score: 3 } ] },
                { id: 12, text: translations.en.q12, options: [ { text: translations.en.o12_1, trait: "D", score: 4 }, { text: translations.en.o12_2, trait: "I", score: 4 }, { text: translations.en.o12_3, trait: "S", score: 4 }, { text: translations.en.o12_4, trait: "C", score: 4 } ] },
                { id: 13, text: translations.en.q13, options: [ { text: translations.en.o13_1, trait: "D", score: 4 }, { text: translations.en.o13_2, trait: "I", score: 4 }, { text: translations.en.o13_3, trait: "S", score: 4 }, { text: translations.en.o13_4, trait: "C", score: 4 } ] },
                { id: 14, text: translations.en.q14, options: [ { text: translations.en.o14_1, trait: "D", score: 4 }, { text: translations.en.o14_2, trait: "I", score: 3 }, { text: translations.en.o14_3, trait: "S", score: 3 }, { text: translations.en.o14_4, trait: "C", score: 4 } ] },
                { id: 15, text: translations.en.q15, options: [ { text: translations.en.o15_1, trait: "D", score: 3 }, { text: translations.en.o15_2, trait: "I", score: 3 }, { text: translations.en.o15_3, trait: "S", score: 3 }, { text: translations.en.o15_4, trait: "C", score: 3 } ] },
                { id: 16, text: translations.en.q16, options: [ { text: translations.en.o16_1, trait: "D", score: 4 }, { text: translations.en.o16_2, trait: "I", score: 4 }, { text: translations.en.o16_3, trait: "S", score: 4 }, { text: translations.en.o16_4, trait: "C", score: 4 } ] },
                { id: 17, text: translations.en.q17, options: [ { text: translations.en.o17_1, trait: "D", score: 4 }, { text: translations.en.o17_2, trait: "I", score: 4 }, { text: translations.en.o17_3, trait: "S", score: 4 }, { text: translations.en.o17_4, trait: "C", score: 4 } ] },
                { id: 18, text: translations.en.q18, options: [ { text: translations.en.o18_1, trait: "D", score: 4 }, { text: translations.en.o18_2, trait: "I", score: 4 }, { text: translations.en.o18_3, trait: "S", score: 3 }, { text: translations.en.o18_4, trait: "C", score: 4 } ] },
                { id: 19, text: translations.en.q19, options: [ { text: translations.en.o19_1, trait: "D", score: 4 }, { text: translations.en.o19_2, trait: "I", score: 4 }, { text: translations.en.o19_3, trait: "S", score: 4 }, { text: translations.en.o19_4, trait: "C", score: 4 } ] },
                { id: 20, text: translations.en.q20, options: [ { text: translations.en.o20_1, trait: "D", score: 4 }, { text: translations.en.o20_2, trait: "I", score: 4 }, { text: translations.en.o20_3, trait: "S", score: 4 }, { text: translations.en.o20_4, trait: "C", score: 4 } ] }
            ]
        };

        // ===== ZODIAC SIGNS =====
        const zodiacSignsData = {
            ar: {
                'الحمل': { dates: [3, 21, 4, 19], element: 'نار' }, 'الثور': { dates: [4, 20, 5, 20], element: 'أرض' },
                'الجوزاء': { dates: [5, 21, 6, 20], element: 'هواء' }, 'السرطان': { dates: [6, 21, 7, 22], element: 'ماء' },
                'الأسد': { dates: [7, 23, 8, 22], element: 'نار' }, 'العذراء': { dates: [8, 23, 9, 22], element: 'أرض' },
                'الميزان': { dates: [9, 23, 10, 22], element: 'هواء' }, 'العقرب': { dates: [10, 23, 11, 21], element: 'ماء' },
                'القوس': { dates: [11, 22, 12, 21], element: 'نار' }, 'الجدي': { dates: [12, 22, 1, 19], element: 'أرض' },
                'الدلو': { dates: [1, 20, 2, 18], element: 'هواء' }, 'الحوت': { dates: [2, 19, 3, 20], element: 'ماء' }
            },
            en: {
                'Aries': { dates: [3, 21, 4, 19], element: 'Fire' }, 'Taurus': { dates: [4, 20, 5, 20], element: 'Earth' },
                'Gemini': { dates: [5, 21, 6, 20], element: 'Air' }, 'Cancer': { dates: [6, 21, 7, 22], element: 'Water' },
                'Leo': { dates: [7, 23, 8, 22], element: 'Fire' }, 'Virgo': { dates: [8, 23, 9, 22], element: 'Earth' },
                'Libra': { dates: [9, 23, 10, 22], element: 'Air' }, 'Scorpio': { dates: [10, 23, 11, 21], element: 'Water' },
                'Sagittarius': { dates: [11, 22, 12, 21], element: 'Fire' }, 'Capricorn': { dates: [12, 22, 1, 19], element: 'Earth' },
                'Aquarius': { dates: [1, 20, 2, 18], element: 'Air' }, 'Pisces': { dates: [2, 19, 3, 20], element: 'Water' }
            }
        };

        // ===== COMPATIBILITY MATRIX =====
        const compatibilityMatrix = {
            'D': { 'D': 75, 'I': 90, 'S': 65, 'C': 80 },
            'I': { 'D': 90, 'I': 85, 'S': 95, 'C': 70 },
            'S': { 'D': 65, 'I': 95, 'S': 80, 'C': 85 },
            'C': { 'D': 80, 'I': 70, 'S': 85, 'C': 90 }
        };

        // ===== APP STATE =====
        let state = {
            lang: 'ar',
            page: 'userInfo',
            userData: { age: '', gender: '', dob: '' },
            currentQ: 0,
            userAnswers: [],
            personalityScore: {},
            zodiacSign: '',
            partnerAnalysis: null,
            resultText: ''
        };

        // ===== UTILITY FUNCTIONS =====
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function getZodiacSign(birthDate) {
            const date = new Date(birthDate);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const signs = zodiacSignsData[state.lang];
            for (let sign in signs) {
                const [startMonth, startDay, endMonth, endDay] = signs[sign].dates;
                if ((month === startMonth && day >= startDay) || (month === endMonth && day <= endDay)) {
                    return sign;
                }
            }
            // Capricorn edge case (Dec-Jan)
            if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) {
                return state.lang === 'ar' ? 'الجدي' : 'Capricorn';
            }
            return state.lang === 'ar' ? 'الحمل' : 'Aries';
        }

        function showToast(message, duration = 3000) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 400);
            }, duration);
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast(translations[state.lang].alert_copied);
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast(translations[state.lang].alert_copied);
            }
        }

        // ===== PERSONALITY ANALYSIS =====
        function analyzePersonality(answers) {
            const scores = { 'D': 0, 'I': 0, 'S': 0, 'C': 0 };
            const questionsData = questions[state.lang];
            answers.forEach((answerIndex, questionIndex) => {
                if (answerIndex !== undefined && questionsData[questionIndex]) {
                    const option = questionsData[questionIndex].options[answerIndex];
                    if (option && option.trait) {
                        scores[option.trait] = (scores[option.trait] || 0) + (option.score || 1);
                    }
                }
            });
            return scores;
        }

        function generatePersonalityAnalysis(answers, userData) {
            const scores = analyzePersonality(answers);
            state.personalityScore = scores;
            const primaryTrait = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            
            const personalityTypes = {
                ar: {
                    'D': { name: 'القائد المهيمن (الأحمر)', description: `أنت شخصية قيادية بطبيعتك، تمتلك إرادة قوية وتحب التحكم في الأمور. لا تهاب التحديات، وتميل إلى اتخاذ القرارات بسرعة وثقة. أنت موجه نحو النتائج، وتحب أن ترى تقدماً ملموساً. قد تبدو أحياناً حازماً أكثر من اللازم، لكن دافعك هو إحداث تأثير حقيقي.` },
                    'I': { name: 'الشخصية المؤثرة (الأصفر)', description: `أنت شخصية اجتماعية، محبوبة، ومحفزة. تمتلك طاقة إيجابية عالية، وتحب أن تكون محور الاهتمام. تُحدث تأثيراً من خلال كلماتك وحماسك، وتميل إلى بناء العلاقات بسهولة. قد تفتقر أحياناً للتنظيم، لكنك تُكمل ذلك بقدرتك على إلهام الآخرين وتحفيزهم.` },
                    'S': { name: 'الشخصية المستقرة (الأخضر)', description: `أنت شخصية هادئة، موثوقة، وداعمة. تكره التوتر والصراع، وتحب الاستقرار والانسجام. أنت صبور، وفيّ، وتحافظ على العلاقات لفترة طويلة. قد تقاوم التغيير في البداية، لكنك تُحدث تأثيراً عميقاً من خلال ولائك وثباتك.` },
                    'C': { name: 'الشخصية الواعية (الأزرق)', description: `أنت شخصية تحليلية، دقيقة، ومنطقية. تهتم بالتفاصيل، وتسعى لتحقيق الجودة في كل ما تفعل. تتخذ قراراتك بناءً على التفكير العميق، وتحب أن يكون كل شيء منظمًا. قد تبدو بارداً أحياناً، لكن دافعك هو السعي نحو الكمال والدقة.` }
                },
                en: {
                    'D': { name: 'Dominant Leader (Red)', description: `You are a natural leader with a strong will, loving to be in control. You don't fear challenges and tend to make decisions quickly and confidently. You are results-oriented and love to see tangible progress. You might seem overly assertive at times, but your drive is to make a real impact.` },
                    'I': { name: 'Influential Personality (Yellow)', description: `You are a social, beloved, and motivating person. You have high positive energy and love being the center of attention. You make an impact through your words and enthusiasm, and you build relationships easily. You might sometimes lack organization, but you compensate with your ability to inspire and motivate others.` },
                    'S': { name: 'Stable Personality (Green)', description: `You are a calm, reliable, and supportive person. You dislike stress and conflict, preferring stability and harmony. You are patient, loyal, and maintain long-term relationships. You might resist change initially, but you make a deep impact through your loyalty and steadfastness.` },
                    'C': { name: 'Conscientious Personality (Blue)', description: `You are an analytical, precise, and logical person. You care about details and strive for quality in everything you do. You make decisions based on deep thought and like everything to be organized. You might seem cold at times, but your drive is the pursuit of perfection and accuracy.` }
                }
            };

            const strengths = {
                ar: {
                    'D': ['اتخاذ قرارات سريعة', 'قيادة الفرق', 'التركيز على النتائج', 'الثقة بالنفس'],
                    'I': ['التواصل والتأثير', 'تحفيز الآخرين', 'المرونة العالية', 'بناء العلاقات'],
                    'S': ['الاستماع الجيد', 'الوفاء والالتزام', 'تهدئة المواقف', 'العمل الجماعي'],
                    'C': ['الدقة والانتباه', 'التفكير المنطقي', 'الالتزام بالجودة', 'التنظيم الممتاز']
                },
                en: {
                    'D': ['Quick decision-making', 'Leading teams', 'Focus on results', 'Self-confidence'],
                    'I': ['Communication & influence', 'Motivating others', 'High flexibility', 'Building relationships'],
                    'S': ['Good listening', 'Loyalty & commitment', 'Calming situations', 'Teamwork'],
                    'C': ['Precision & attention', 'Logical thinking', 'Commitment to quality', 'Excellent organization']
                }
            };

            const growthAreas = {
                ar: {
                    'D': ['الاستماع أكثر للآخرين', 'منح مساحة للقرارات', 'التعامل بلطف أكبر', 'الاعتراف بالمشاعر'],
                    'I': ['التركيز على المهام', 'اتباع خطة منظمة', 'التعامل مع النقد', 'تطوير الصبر'],
                    'S': ['التحدث عن احتياجاتك', 'اتخاذ موقف حاسم', 'الانفتاح على التغيير', 'الاعتناء بنفسك أولاً'],
                    'C': ['التحدث عن المشاعر', 'اتخاذ قرارات أسرع', 'التعامل مع الأخطاء', 'الثقة بالآخرين']
                },
                en: {
                    'D': ['Listen more to others', 'Give space for decisions', 'Be more gentle', 'Acknowledge feelings'],
                    'I': ['Focus on tasks', 'Follow an organized plan', 'Handle criticism', 'Develop patience'],
                    'S': ['Speak up for your needs', 'Take a firm stance', 'Be open to change', 'Prioritize self-care'],
                    'C': ['Talk about feelings', 'Make faster decisions', 'Handle mistakes as learning', 'Trust others with tasks']
                }
            };

            const mainType = personalityTypes[state.lang][primaryTrait];
            const t = translations[state.lang];

            let html = `
                <div class="glass-card rounded-xl p-6 mb-6">
                    <h3 class="text-2xl font-bold gradient-text mb-4">${t.personality_section}</h3>
                    <p class="text-gray-300 mb-4">${t.analysis_intro}</p>
                    <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg p-4 mb-4">
                        <h4 class="text-xl font-bold text-yellow-400 mb-2">${mainType.name}</h4>
                        <p class="text-gray-300 leading-relaxed">${mainType.description}</p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-semibold text-green-400 mb-2">${state.lang === 'ar' ? 'نقاط قوتك:' : 'Your Strengths:'}</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${strengths[state.lang][primaryTrait].map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-orange-400 mb-2">${state.lang === 'ar' ? 'مجالات النمو:' : 'Growth Areas:'}</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${growthAreas[state.lang][primaryTrait].map(g => `<li>${g}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            return { html, primaryTrait, mainTypeName: mainType.name, mainTypeDesc: mainType.description };
        }

        function generatePartnerAnalysis(userPrimaryTrait, userZodiac) {
            const partnerTraitsData = {
                ar: {
                    'D': { ideal: 'I', name: 'الشخصية المؤثرة', desc: 'يحتاج القائد لشريك يوازن قوته بالدفء والتفاعل.', traits: ['مرح', 'يقدر الإنجاز', 'مرن', 'يشارك بالأهداف'], advice: ['امنحه مساحة للتعبير', 'تعلم الاستماع', 'اهتم بالعاطفة'] },
                    'I': { ideal: 'S', name: 'الشخصية المستقرة', desc: 'تحتاج الشخصية المؤثرة لشريك يوفر الاستقرار والأمان.', traits: ['صبور', 'يقدر التفاعل', 'مخلص', 'يوفر الاستقرار'], advice: ['قدر حاجته للهدوء', 'لا تضغط للتغيير', 'أظهر التقدير'] },
                    'S': { ideal: 'I', name: 'الشخصية المؤثرة', desc: 'تحتاج الشخصية المستقرة لشريك يجلب الحيوية والطاقة.', traits: ['نشيط', 'مرح', 'اجتماعي', 'متفائل'], advice: ['كن صبوراً', 'شاركه اجتماعياً', 'أظهر التقدير'] },
                    'C': { ideal: 'D', name: 'القائد المهيمن', desc: 'تحتاج الشخصية الواعية لشريك يقدر دقتها ويوفر الدعم.', traits: ['حاسم', 'يقدر الجودة', 'سريع القرار', 'يوفر الحماية'], advice: ['احترم حاجته للتفكير', 'قدر التفاصيل', 'كن واضحاً'] }
                },
                en: {
                    'D': { ideal: 'I', name: 'The Influential', desc: 'The leader needs a partner who balances their strength with warmth and social interaction.', traits: ['Fun-loving', 'Appreciates achievement', 'Flexible', 'Shares goals'], advice: ['Give them space to express', 'Learn to listen more', 'Care for the emotional side'] },
                    'I': { ideal: 'S', name: 'The Stable', desc: 'The influential personality needs a partner who provides stability and emotional security.', traits: ['Patient', 'Values social interaction', 'Loyal', 'Provides stability'], advice: ['Respect their need for calm', 'Don’t push for quick change', 'Show continuous appreciation'] },
                    'S': { ideal: 'I', name: 'The Influential', desc: 'The stable personality needs a partner who brings vitality and energy to life.', traits: ['Energetic', 'Fun', 'Social', 'Optimistic'], advice: ['Be patient', 'Join them socially', 'Show appreciation'] },
                    'C': { ideal: 'D', name: 'The Dominant', desc: 'The conscientious personality needs a partner who appreciates their precision and provides support.', traits: ['Decisive', 'Values quality', 'Quick decision-maker', 'Provides protection'], advice: ['Respect their need to think', 'Appreciate details', 'Be clear in communication'] }
                }
            };

            const zodiacCompatibility = {
                ar: { 'الحمل': ['الأسد', 'القوس'], 'الثور': ['العذراء', 'الجدي'], 'الجوزاء': ['الميزان', 'الدلو'], 'السرطان': ['العقرب', 'الحوت'], 'الأسد': ['الحمل', 'القوس'], 'العذراء': ['الثور', 'الجدي'], 'الميزان': ['الجوزاء', 'الدلو'], 'العقرب': ['السرطان', 'الحوت'], 'القوس': ['الحمل', 'الأسد'], 'الجدي': ['الثور', 'العذراء'], 'الدلو': ['الجوزاء', 'الميزان'], 'الحوت': ['السرطان', 'العقرب'] },
                en: { 'Aries': ['Leo', 'Sagittarius'], 'Taurus': ['Virgo', 'Capricorn'], 'Gemini': ['Libra', 'Aquarius'], 'Cancer': ['Scorpio', 'Pisces'], 'Leo': ['Aries', 'Sagittarius'], 'Virgo': ['Taurus', 'Capricorn'], 'Scorpio': ['Cancer', 'Pisces'], 'Libra': ['Gemini', 'Aquarius'], 'Sagittarius': ['Aries', 'Leo'], 'Capricorn': ['Taurus', 'Virgo'], 'Aquarius': ['Gemini', 'Libra'], 'Pisces': ['Cancer', 'Scorpio'] }
            };

            const partnerInfo = partnerTraitsData[state.lang][userPrimaryTrait];
            const personalityCompatibility = compatibilityMatrix[userPrimaryTrait][partnerInfo.ideal];
            const compatibleSigns = zodiacCompatibility[state.lang][userZodiac] || [];
            const overallScore = Math.round(personalityCompatibility);

            return {
                partnerPersonality: partnerInfo,
                compatibleZodiacSigns: compatibleSigns,
                primaryZodiacMatch: compatibleSigns[0] || (state.lang === 'ar' ? 'غير محدد' : 'Not specified'),
                compatibilityScore: overallScore
            };
        }

        // ===== RENDER RESULT =====
        function renderResult() {
            const t = translations[state.lang];
            const { html: personalityHtml, primaryTrait, mainTypeName, mainTypeDesc } = generatePersonalityAnalysis(state.userAnswers, state.userData);
            const zodiacSign = getZodiacSign(state.userData.dob);
            state.zodiacSign = zodiacSign;
            const partnerAnalysis = generatePartnerAnalysis(primaryTrait, zodiacSign);
            state.partnerAnalysis = partnerAnalysis;

            // Generate text for sharing/copying
            const resultSummary = `
${t.welcome_title}
--------------------
${t.personality_section}: ${mainTypeName}
${mainTypeDesc}
--------------------
${t.partner_section}: ${partnerAnalysis.partnerPersonality.name}
${t.compatibility_title}: ${partnerAnalysis.compatibilityScore}%
${t.zodiac_section}: ${zodiacSign}
--------------------
اكتشف شخصيتك أنت أيضاً! ${window.location.href}
            `.trim();
            state.resultText = resultSummary;

            return `
                <div class="animate-fade-in space-y-8">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold gradient-text mb-2">${t.welcome_title}</h2>
                        <p class="text-gray-300">${t.lang === 'ar' ? 'تحليل شامل لشخصيتك وشريك حياتك المثالي' : 'A comprehensive analysis of your personality and ideal partner'}</p>
                    </div>

                    ${personalityHtml}

                    <div class="glass-card rounded-xl p-6 mb-6">
                        <h3 class="text-2xl font-bold gradient-text mb-4">${t.partner_analysis_title}</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-xl font-bold text-pink-400 mb-3">${t.lang === 'ar' ? 'شخصية الشريك المثالي:' : 'Ideal Partner Personality:'}</h4>
                                <p class="text-gray-300 mb-2 font-semibold">${partnerAnalysis.partnerPersonality.name}</p>
                                <p class="text-gray-400 text-sm mb-4">${partnerAnalysis.partnerPersonality.desc}</p>
                                <h5 class="font-semibold text-green-400 mb-2">${t.partner_traits}:</h5>
                                <ul class="list-disc list-inside text-gray-300 space-y-1">
                                    ${partnerAnalysis.partnerPersonality.traits.map(trait => `<li>${trait}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold
// ... (تكملة من منتصف دالة renderResult)
                                <h4 class="text-xl font-bold text-blue-400 mb-3">${t.lang === 'ar' ? 'التوافق الفلكي:' : 'Zodiac Compatibility:'}</h4>
                                <p class="text-gray-300 mb-2"><strong>${t.lang === 'ar' ? 'برجك:' : 'Your Sign:'}</strong> ${zodiacSign}</p>
                                <p class="text-gray-300 mb-4"><strong>${t.lang === 'ar' ? 'الأبراج الأكثر توافقًا:' : 'Most Compatible Signs:'}</strong> ${partnerAnalysis.compatibleZodiacSigns.join('، ')}</p>
                                <div class="text-center mb-4">
                                    <div class="compatibility-score">${partnerAnalysis.compatibilityScore}%</div>
                                    <p class="text-sm text-gray-400">${t.compatibility_title}</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 border-t border-slate-700 pt-4">
                            <h5 class="font-semibold text-purple-400 mb-2">${t.relationship_advice}:</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${partnerAnalysis.partnerPersonality.advice.map(advice => `<li>${advice}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-4 justify-center">
                        <button id="copyBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            <i class="fas fa-copy mr-2"></i>${t.copy_btn}
                        </button>
                        <button id="shareBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            <i class="fas fa-share-alt mr-2"></i>${t.share_btn}
                        </button>
                        <button id="restartBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            <i class="fas fa-redo mr-2"></i>${t.restart_btn}
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== RENDER FUNCTIONS =====
        function render() {
            const t = translations[state.lang];
            document.documentElement.lang = state.lang;
            document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr';
            let html = `
                <div class="fixed top-4 ${state.lang === 'ar' ? 'left-4' : 'right-4'} z-50">
                    <button id="langToggle" class="bg-yellow-400 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">
                        ${state.lang === 'ar' ? 'EN' : 'AR'}
                    </button>
                </div>
            `;

            switch (state.page) {
                case 'userInfo':
                    html += renderUserInfo();
                    break;
                case 'intro':
                    html += renderIntro();
                    break;
                case 'quiz':
                    html += renderQuiz();
                    break;
                case 'result':
                    html += renderResult();
                    break;
            }

            html += `
                <footer class="mt-16 text-center text-gray-400 space-y-2 text-sm">
                    <p class="font-semibold">${t.lang === 'ar' ? `جميع الحقوق محفوظة © ${new Date().getFullYear()} | تم التطوير بواسطة` : `All rights reserved © ${new Date().getFullYear()} | Developed by`} <strong>Mohammed Tarek</strong></p>
                    <p>${t.footer2}</p>
                </footer>
            `;

            document.getElementById('app').innerHTML = html;
            setupEventListeners();
        }

        function renderUserInfo() {
            const t = translations[state.lang];
            return `
                <div class="animate-fade-in">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold gradient-text mb-4">${t.welcome_title}</h1>
                        <p class="text-gray-300 text-lg">${t.lang === 'ar' ? 'اكتشف شخصيتك الحقيقية ورفيق دربك المثالي' : 'Discover your true personality and ideal partner'}</p>
                    </div>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="lg:w-1/3 w-full">
                            <div id="ageCard" class="glass-card rounded-2xl p-6 text-center border-2 border-yellow-400/30">
                                <div class="text-lg font-semibold mb-2">${t.age_label}</div>
                                <div id="calculatedAge" class="text-5xl font-bold gradient-text mb-2">
                                    ${state.userData.age || '-'}
                                </div>
                                <div class="text-gray-400">${t.lang === 'ar' ? 'سنة' : 'Years'}</div>
                            </div>
                        </div>
                        <div class="lg:w-2/3 w-full">
                            <div class="glass-card rounded-xl p-6">
                                <h3 class="text-2xl font-bold mb-4">${t.user_info_title}</h3>
                                <p class="text-gray-300 mb-6">${t.user_info_desc}</p>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${t.gender_label}</label>
                                        <select id="gender" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:border-yellow-400 focus:outline-none">
                                            <option value="">${t.lang === 'ar' ? 'اختر الجنس' : 'Select Gender'}</option>
                                            <option value="male" ${state.userData.gender === 'male' ? 'selected' : ''}>${t.male}</option>
                                            <option value="female" ${state.userData.gender === 'female' ? 'selected' : ''}>${t.female}</option>
                                            <option value="other" ${state.userData.gender === 'other' ? 'selected' : ''}>${t.other}</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${t.dob_label}</label>
                                        <input type="date" id="dob" value="${state.userData.dob || ''}" 
                                               class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:border-yellow-400 focus:outline-none"
                                               style="color-scheme: dark;">
                                    </div>
                                    <button id="submitUserInfo" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-slate-900 font-bold py-3 px-6 rounded-lg hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105">
                                        ${t.submit_user_info}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIntro() {
            const t = translations[state.lang];
            return `
                <div class="animate-fade-in text-center">
                    <div class="glass-card rounded-xl p-8 max-w-3xl mx-auto">
                        <h1 class="text-4xl font-bold gradient-text mb-4">${t.intro_title}</h1>
                        <h2 class="text-2xl font-semibold text-purple-400 mb-6">${t.intro_subtitle}</h2>
                        <div class="w-32 h-1 bg-gradient-to-r from-yellow-400 to-purple-500 mx-auto mb-8"></div>
                        <div class="space-y-4 text-gray-300 text-lg mb-8">
                            <p>${t.intro_desc}</p>
                            <p>${t.intro_p1}</p>
                            <p>${t.intro_p2}</p>
                        </div>
                        <button id="startBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-8 rounded-lg text-xl hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                            <i class="fas fa-rocket ${state.lang === 'ar' ? 'ml-2' : 'mr-2'}"></i>${t.start_btn}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const t = translations[state.lang];
            const questionsData = questions[state.lang];
            const q = questionsData[state.currentQ];
            const progress = Math.floor(((state.currentQ + 1) / questionsData.length) * 100);
            return `
                <div class="animate-fade-in">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">${t.progress}</span>
                            <span class="text-sm font-semibold">${state.currentQ + 1} / ${questionsData.length}</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-3">
                            <div class="progress-bar h-3 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-6 mb-6">
                        <h3 class="text-2xl font-bold mb-6 text-center">${state.currentQ + 1}. ${q.text}</h3>
                        <div class="space-y-3">
                            ${q.options.map((opt, idx) => `
                                <button class="option-btn w-full p-4 rounded-lg text-${state.lang === 'ar' ? 'right' : 'left'} transition-all ${
                                    state.userAnswers[state.currentQ] === idx ? 'selected' : ''
                                }" data-opt="${idx}">
                                    <div class="flex items-center justify-between">
                                        <span>${opt.text}</span>
                                        <i class="fas fa-check-circle text-lg ${state.userAnswers[state.currentQ] === idx ? 'text-yellow-400' : 'text-transparent'}"></i>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                        <button id="nextBtn" class="w-full mt-6 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all">
                            ${state.currentQ === questionsData.length - 1 ? t.final_results_btn : t.next_btn}
                            <i class="fas ${state.lang === 'ar' ? 'fa-arrow-left mr-2' : 'fa-arrow-right ml-2'}"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            document.getElementById('app').addEventListener('click', handleClick);
            const dobInput = document.getElementById('dob');
            if (dobInput) {
                dobInput.addEventListener('input', function() {
                    const date = this.value;
                    if (date && new Date(date) < new Date()) {
                        const age = calculateAge(date);
                        document.getElementById('calculatedAge').textContent = age;
                        state.userData.dob = date;
                        state.userData.age = age.toString();
                    } else {
                        document.getElementById('calculatedAge').textContent = '-';
                        state.userData.dob = '';
                        state.userData.age = '';
                        if (date) showToast(translations[state.lang].alert_invalid_dob);
                    }
                });
            }
            const genderSelect = document.getElementById('gender');
            if (genderSelect) {
                genderSelect.addEventListener('change', function() {
                    state.userData.gender = this.value;
                });
            }
        }

        function handleClick(e) {
            const t = translations[state.lang];
            const target = e.target.closest('button');
            if (!target) return;

            if (target.id === 'langToggle') {
                state.lang = state.lang === 'ar' ? 'en' : 'ar';
                render();
            }
            if (target.id === 'submitUserInfo') {
                const { age, gender, dob } = state.userData;
                if (!age || !gender || !dob) {
                    showToast(t.alert_missing_fields);
                    return;
                }
                state.page = 'intro';
                render();
            }
            if (target.id === 'startBtn') {
                state.page = 'quiz';
                state.currentQ = 0;
                state.userAnswers = [];
                render();
            }
            if (target.classList.contains('option-btn')) {
                const idx = parseInt(target.getAttribute('data-opt'));
                state.userAnswers[state.currentQ] = idx;
                render();
            }
            if (target.id === 'nextBtn') {
                const questionsData = questions[state.lang];
                if (state.userAnswers[state.currentQ] === undefined) {
                    showToast(t.alert_no_answer);
                    return;
                }
                if (state.currentQ < questionsData.length - 1) {
                    state.currentQ++;
                    render();
                } else {
                    state.page = 'result';
                    render();
                }
            }
            if (target.id === 'restartBtn') {
                state = {
                    ...state, // keep lang
                    page: 'userInfo',
                    userData: { age: '', gender: '', dob: '' },
                    currentQ: 0,
                    userAnswers: [],
                    personalityScore: {},
                    zodiacSign: '',
                    partnerAnalysis: null
                };
                render();
            }
            if (target.id === 'copyBtn') {
                copyToClipboard(state.resultText);
            }
            if (target.id === 'shareBtn') {
                if (navigator.share) {
                    navigator.share({
                        title: t.welcome_title,
                        text: state.resultText,
                        url: window.location.href
                    });
                } else {
                    copyToClipboard(state.resultText);
                }
            }
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });
    </script>
</body>
</html>
