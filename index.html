<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>غرفة الأسرار | Chamber of Secrets</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }
        .gradient-text {
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .option-btn {
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
        }
        .option-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-2px);
        }
        .option-btn.selected {
            background: rgba(251, 191, 36, 0.2);
            border-color: #fbbf24;
            color: #fbbf24;
        }
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #fbbf24);
            transition: width 0.5s ease;
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #fbbf24, #ef4444);
            color: #1e293b;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            animation: toastSlide 0.4s ease forwards;
        }
        @keyframes toastSlide {
            to { opacity: 1; }
        }
        .zodiac-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .partner-card {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(251, 191, 36, 0.1));
            border: 1px solid rgba(236, 72, 153, 0.3);
        }
        .compatibility-score {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ec4899, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        @media print {
            body { background: white !important; color: black !important; }
            .glass-card { background: white !important; border: 1px solid #ccc !important; }
        }
    </style>
</head>
<body class="text-white">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl"></div>
    <script>
        // ===== TRANSLATIONS =====
        const translations = {
            ar: {
                welcome_title: "مرحباً بك في غرفة الأسرار",
                user_info_title: "معلوماتك الشخصية",
                user_info_desc: "دعنا نتعرف عليك أكثر لنقدم لك تحليلاً دقيقاً",
                age_label: "العمر",
                gender_label: "الجنس",
                dob_label: "تاريخ الميلاد",
                submit_user_info: "التالي",
                intro_title: "استعد لرحلة اكتشاف الذات",
                intro_subtitle: "تحليل شخصيتك ومعرفة رفيق دربك",
                intro_desc: "ستخوض رحلة من 20 سؤالاً مصممة خصيصاً لكشف أعماق شخصيتك",
                intro_p1: "سنحلل شخصيتك وفقاً لأحدث النظريات النفسية",
                intro_p2: "وسنساعدك في اكتشاف الشريك المثالي لك",
                start_btn: "ابدأ الرحلة",
                progress: "التقدم:",
                next_btn: "التالي",
                restart_btn: "ابدأ من جديد",
                share_btn: "مشاركة النتيجة",
                copy_btn: "نسخ النتيجة",
                zodiac_title: "اعرف برجك",
                partner_title: "رفيق دربك",
                zodiac_intro: "برجك هو",
                zodiac_daily: "اليوم:",
                zodiac_weekly: "هذا الأسبوع:",
                zodiac_yearly: "هذا العام:",
                zodiac_hint: "الأبراج مجرد تسلية، الأهم هو شخصيتك الحقيقية",
                alert_missing_fields: "يرجى ملء جميع الحقول",
                alert_invalid_dob: "تاريخ ميلاد غير صحيح",
                alert_no_answer: "يرجى اختيار إجابة",
                footer1: "غرفة الأسرار - اكتشف شخصيتك الحقيقية",
                footer2: "مطور بحب ❤️ لمساعدتك في فهم نفسك أكثر",
                male: "ذكر",
                female: "أنثى",
                other: "آخر",
                compatibility_title: "نسبة التوافق",
                partner_traits: "صفات الشريك المثالي",
                relationship_advice: "نصائح للعلاقة",
                analysis_intro: "بعد تحليل إجاباتك، تم تحديد طبيعة شخصيتك على النحو التالي:",
                personality_section: "تحليل شخصيتك",
                zodiac_section: "برجك الفلكي",
                partner_section: "الشريك المثالي لك",
                partner_analysis_title: "تحليل مفصل للشريك المثالي",
                // Questions
                q1: "عندما تستيقظ في الصباح، ما أول شيء يخطر ببالك؟",
                o1_1: "أنا متحمس لأبدأ يومي!",
                o1_2: "هل كل شيء تحت السيطرة؟",
                o1_3: "هل سأكون كافيًا اليوم؟",
                o1_4: "أريد أن أفهم معنى هذا اليوم",
                q2: "في لقاء اجتماعي جديد، ماذا تفعل؟",
                o2_1: "أبدأ الحديث مع الجميع بسرعة",
                o2_2: "أراقب أولًا ثم أتحدث مع شخص واحد",
                o2_3: "أركز على من يمكن أن يفيدني أو أفيد منه",
                o2_4: "أحاول فهم مشاعر الآخرين بسرعة",
                q3: "ما نوع المهمة التي تجعلك 'تُنسى' من نفسك؟",
                o3_1: "التحديات السريعة والملتزمة بالوقت",
                o3_2: "التحليل العميق للبيانات أو الأنظمة",
                o3_3: "مساعدة شخص على تجاوز أزمة",
                o3_4: "تنظيم فريق لتحقيق هدف منظم"
            },
            en: {
                welcome_title: "Welcome to Chamber of Secrets",
                user_info_title: "Your Personal Information",
                user_info_desc: "Let us get to know you better for accurate analysis",
                age_label: "Age",
                gender_label: "Gender",
                dob_label: "Date of Birth",
                submit_user_info: "Next",
                intro_title: "Prepare for Self-Discovery Journey",
                intro_subtitle: "Analyze your personality and find your life partner",
                intro_desc: "You'll embark on a journey of 20 questions designed to reveal your personality depths",
                intro_p1: "We'll analyze your personality according to the latest psychological theories",
                intro_p2: "And help you discover your ideal partner",
                start_btn: "Start Journey",
                progress: "Progress:",
                next_btn: "Next",
                restart_btn: "Start Over",
                share_btn: "Share Result",
                copy_btn: "Copy Result",
                zodiac_title: "Know Your Sign",
                partner_title: "Life Partner",
                zodiac_intro: "Your sign is",
                zodiac_daily: "Today:",
                zodiac_weekly: "This week:",
                zodiac_yearly: "This year:",
                zodiac_hint: "Zodiac signs are just for fun, what matters is your real personality",
                alert_missing_fields: "Please fill all fields",
                alert_invalid_dob: "Invalid birth date",
                alert_no_answer: "Please select an answer",
                footer1: "Chamber of Secrets - Discover Your True Personality",
                footer2: "Developed with love ❤️ to help you understand yourself better",
                male: "Male",
                female: "Female",
                other: "Other",
                compatibility_title: "Compatibility Score",
                partner_traits: "Ideal Partner Traits",
                relationship_advice: "Relationship Advice",
                analysis_intro: "Based on your answers, here's a detailed analysis of your personality:",
                personality_section: "Your Personality",
                zodiac_section: "Your Zodiac Sign",
                partner_section: "Your Ideal Partner",
                partner_analysis_title: "Detailed Partner Analysis"
            }
        };

        // ===== QUESTIONS (20 كاملة) =====
        const questions = {
            ar: [
                {
                    id: 1,
                    text: "عندما تستيقظ في الصباح، ما أول شيء يخطر ببالك؟",
                    options: [
                        { text: "أنا متحمس لأبدأ يومي!", trait: "E", score: 4 },
                        { text: "هل كل شيء تحت السيطرة؟", trait: "C", score: 3 },
                        { text: "هل سأكون كافيًا اليوم؟", trait: "N", score: 2 },
                        { text: "أريد أن أفهم معنى هذا اليوم", trait: "I", score: 3 }
                    ]
                },
                {
                    id: 2,
                    text: "في لقاء اجتماعي جديد، ماذا تفعل؟",
                    options: [
                        { text: "أبدأ الحديث مع الجميع بسرعة", trait: "E", score: 4 },
                        { text: "أراقب أولًا ثم أتحدث مع شخص واحد", trait: "I", score: 4 },
                        { text: "أركز على من يمكن أن يفيدني أو أفيد منه", trait: "T", score: 3 },
                        { text: "أحاول فهم مشاعر الآخرين بسرعة", trait: "F", score: 4 }
                    ]
                },
                {
                    id: 3,
                    text: "ما نوع المهمة التي تجعلك 'تُنسى' من نفسك؟",
                    options: [
                        { text: "التحديات السريعة والملتزمة بالوقت", trait: "D", score: 4 },
                        { text: "التحليل العميق للبيانات أو الأنظمة", trait: "C", score: 4 },
                        { text: "مساعدة شخص على تجاوز أزمة", trait: "S", score: 4 },
                        { text: "تنظيم فريق لتحقيق هدف منظم", trait: "I", score: 3 }
                    ]
                },
                {
                    id: 4,
                    text: "ما أكثر شيء تبحث عنه في الصداقات؟",
                    options: [
                        { text: "المرح والطاقة", trait: "I", score: 4 },
                        { text: "الولاء والاستقرار", trait: "S", score: 4 },
                        { text: "العمق والمعنى", trait: "N", score: 4 },
                        { text: "التحدي الفكري", trait: "T", score: 3 }
                    ]
                },
                {
                    id: 5,
                    text: "كيف تتعامل مع الأخطاء؟",
                    options: [
                        { text: "أتعلم وأتحرك بسرعة", trait: "P", score: 4 },
                        { text: "أحلل ما حدث بدقة", trait: "C", score: 4 },
                        { text: "أشعر بالذنب، لكنني أسامح نفسي", trait: "F", score: 3 },
                        { text: "أتساءل: هل هذا يثبت أنني غير كافٍ؟", trait: "N", score: 2 }
                    ]
                },
                {
                    id: 6,
                    text: "ما الذي يُشعرك بالفخر؟",
                    options: [
                        { text: "تحقيق نتائج ملموسة", trait: "D", score: 4 },
                        { text: "دعم شخص في أزمة", trait: "S", score: 4 },
                        { text: "ابتكار فكرة جديدة", trait: "N", score: 4 },
                        { text: "الالتزام بالواجبات والمسؤوليات", trait: "J", score: 3 }
                    ]
                },
                {
                    id: 7,
                    text: "ما الذي تبحث عنه في قرار مهم؟",
                    options: [
                        { text: "السرعة والنتائج", trait: "D", score: 4 },
                        { text: "الإلهام والانطباع الأول", trait: "I", score: 3 },
                        { text: "استقرار الفريق والعلاقات", trait: "S", score: 4 },
                        { text: "التحليل العميق والمنطق", trait: "T", score: 4 }
                    ]
                },
                {
                    id: 8,
                    text: "ماذا تفعل عندما تشعر بالضغط؟",
                    options: [
                        { text: "أتحدى الموقف مباشرة", trait: "D", score: 4 },
                        { text: "أبحث عن دعم من الآخرين", trait: "I", score: 3 },
                        { text: "أبتعد مؤقتًا لأعيد التفكير", trait: "S", score: 3 },
                        { text: "أحلل المشكلة من كل الزوايا", trait: "C", score: 4 }
                    ]
                },
                {
                    id: 9,
                    text: "ما نوع الكتب أو المحتوى الذي تفضله؟",
                    options: [
                        { text: "قصص نجاح، قيادة، تأثير", trait: "D", score: 4 },
                        { text: "روايات، فلسفة، تأملات وجودية", trait: "N", score: 4 },
                        { text: "نكت، فيديوهات مضحكة، ترفيه", trait: "I", score: 3 },
                        { text: "أدلة عملية، خطوات، تقنيات", trait: "S", score: 3 }
                    ]
                },
                {
                    id: 10,
                    text: "ما الذي يعطيك إحساسًا بالمعنى؟",
                    options: [
                        { text: "تحقيق إنجازات كبيرة", trait: "D", score: 4 },
                        { text: "خدمة الآخرين", trait: "S", score: 4 },
                        { text: "فهم الكون أو النظام الكوني", trait: "N", score: 4 },
                        { text: "الاستقرار والانتماء", trait: "F", score: 3 }
                    ]
                },
                {
                    id: 11,
                    text: "كم مرة تغير رأيك بناءً على معلومة جديدة؟",
                    options: [
                        { text: "نادرًا، أنا واثق من قراراتي", trait: "D", score: 4 },
                        { text: "أحيانًا، إذا كانت الحجة قوية", trait: "T", score: 4 },
                        { text: "غالبًا، لأنني أحب التعلم", trait: "N", score: 4 },
                        { text: "دائمًا، لأنني أكره التصلب", trait: "P", score: 3 }
                    ]
                },
                {
                    id: 12,
                    text: "ما الذي يُشعرك بالراحة؟",
                    options: [
                        { text: "تحقيق الهدف", trait: "D", score: 4 },
                        { text: "الضحك والتفاعل", trait: "I", score: 4 },
                        { text: "الهدوء والاستقرار", trait: "S", score: 4 },
                        { text: "النظام والفهم الكامل", trait: "C", score: 4 }
                    ]
                },
                {
                    id: 13,
                    text: "ما هو شعارك في الحياة؟",
                    options: [
                        { text: "النتيجة أهم من الطريقة", trait: "D", score: 4 },
                        { text: "الحياة للمرح والتجربة", trait: "I", score: 4 },
                        { text: "العلاقات تُبنى بالصبر والوفاء", trait: "S", score: 4 },
                        { text: "الفهم يسبق كل شيء", trait: "C", score: 4 }
                    ]
                },
                {
                    id: 14,
                    text: "كيف تتعامل مع الانتقاد؟",
                    options: [
                        { text: "أتحداه وأثبت نفسي", trait: "D", score: 4 },
                        { text: "أضحك وأحوله إلى نكتة", trait: "I", score: 3 },
                        { text: "أتألم لكنني أسامح", trait: "S", score: 3 },
                        { text: "أحلله بمنطق وعقل", trait: "T", score: 4 }
                    ]
                },
                {
                    id: 15,
                    text: "ما الذي يُشعرك بالخوف؟",
                    options: [
                        { text: "الفشل وعدم التحكم", trait: "D", score: 3 },
                        { text: "الوحدة والرفض", trait: "I", score: 3 },
                        { text: "الصراع والانفصال", trait: "S", score: 3 },
                        { text: "الغموض وعدم الفهم", trait: "N", score: 3 }
                    ]
                },
                {
                    id: 16,
                    text: "ما نوع القيادة التي تفضلها؟",
                    options: [
                        { text: "قيادة حاسمة وسريعة", trait: "D", score: 4 },
                        { text: "قيادة ملهمة ومحفزة", trait: "I", score: 4 },
                        { text: "قيادة داعمة ومستقرة", trait: "S", score: 4 },
                        { text: "قيادة منظمة وتحليلية", trait: "C", score: 4 }
                    ]
                },
                {
                    id: 17,
                    text: "ما الذي يُشعرك بالحرية؟",
                    options: [
                        { text: "التحكم في مصيري", trait: "D", score: 4 },
                        { text: "التعبير عن نفسي بحرية", trait: "I", score: 4 },
                        { text: "العيش بسلام مع نفسي", trait: "S", score: 4 },
                        { text: "الفهم العميق للعالم", trait: "N", score: 4 }
                    ]
                },
                {
                    id: 18,
                    text: "كيف تتعامل مع التغيير؟",
                    options: [
                        { text: "أتحداه وأقوده", trait: "D", score: 4 },
                        { text: "أحتفل به وانغمس فيه", trait: "I", score: 4 },
                        { text: "أتأقلم ببطء وحذر", trait: "S", score: 3 },
                        { text: "أحلله وأفهمه أولًا", trait: "C", score: 4 }
                    ]
                },
                {
                    id: 19,
                    text: "ما الذي يحفزك للاستمرار؟",
                    options: [
                        { text: "تحقيق أهدافي الشخصية", trait: "D", score: 4 },
                        { text: "إسعاد الآخرين ورؤيتهم يبتسمون", trait: "I", score: 4 },
                        { text: "الحفاظ على الاستقرار والأمان", trait: "S", score: 4 },
                        { text: "فهم الحقيقة والوصول للكمال", trait: "N", score: 4 }
                    ]
                },
                {
                    id: 20,
                    text: "ما هو أسلوبك في حل المشاكل؟",
                    options: [
                        { text: "أتخذ قرارات سريعة وأتحمل المسؤولية", trait: "D", score: 4 },
                        { text: "أبحث عن آراء الآخرين وأبني حلول جماعية", trait: "I", score: 4 },
                        { text: "أتأني وأفكر في تأثير الحل على الجميع", trait: "S", score: 4 },
                        { text: "أبحث وأحلل حتى أجد الحل الأمثل", trait: "C", score: 4 }
                    ]
                }
            ]
        };

        // ===== ZODIAC SIGNS =====
        const zodiacSigns = {
            ar: {
                'الحمل': { dates: [3, 21, 4, 19], traits: ['قيادي', 'متحمس', 'مغامر', 'مستقل'], element: 'نار' },
                'الثور': { dates: [4, 20, 5, 20], traits: ['مستقر', 'موثوق', 'صبور', 'عملي'], element: 'أرض' },
                'الجوزاء': { dates: [5, 21, 6, 20], traits: ['فضولي', 'تواصلي', 'ذكي', 'متكيف'], element: 'هواء' },
                'السرطان': { dates: [6, 21, 7, 22], traits: ['حساس', 'حنون', 'حدسي', 'محب للعائلة'], element: 'ماء' },
                'الأسد': { dates: [7, 23, 8, 22], traits: ['واثق', 'كريم', 'درامي', 'دافء القلب'], element: 'نار' },
                'العذراء': { dates: [8, 23, 9, 22], traits: ['دقيق', 'عملي', 'متواضع', 'مفيد'], element: 'أرض' },
                'الميزان': { dates: [9, 23, 10, 22], traits: ['دبلوماسي', 'ساحر', 'عادل', 'اجتماعي'], element: 'هواء' },
                'العقرب': { dates: [10, 23, 11, 21], traits: ['عميق', 'شغوف', 'حدسي', 'غامض'], element: 'ماء' },
                'القوس': { dates: [11, 22, 12, 21], traits: ['فيلسوف', 'متفائل', 'مغامر', 'صادق'], element: 'نار' },
                'الجدي': { dates: [12, 22, 1, 19], traits: ['طموح', 'منضبط', 'صبور', 'مسؤول'], element: 'أرض' },
                'الدلو': { dates: [1, 20, 2, 18], traits: ['مبتكر', 'مستقل', 'إنساني', 'أصيل'], element: 'هواء' },
                'الحوت': { dates: [2, 19, 3, 20], traits: ['حدسي', 'رحيم', 'فني', 'حساس'], element: 'ماء' }
            }
        };

        // ===== COMPATIBILITY MATRIX =====
        const compatibilityMatrix = {
            'D': { 'D': 85, 'I': 90, 'S': 70, 'C': 75, 'N': 80, 'T': 85, 'F': 70, 'E': 90, 'P': 75, 'J': 85 },
            'I': { 'D': 90, 'I': 95, 'S': 85, 'C': 70, 'N': 85, 'T': 75, 'F': 90, 'E': 95, 'P': 80, 'J': 70 },
            'S': { 'D': 70, 'I': 85, 'S': 90, 'C': 85, 'N': 75, 'T': 70, 'F': 95, 'E': 80, 'P': 70, 'J': 90 },
            'C': { 'D': 75, 'I': 70, 'S': 85, 'C': 80, 'N': 90, 'T': 95, 'F': 75, 'E': 70, 'P': 85, 'J': 90 }
        };

        // ===== APP STATE =====
        let state = {
            lang: 'ar',
            page: 'userInfo',
            userData: { age: '', gender: '', dob: '' },
            currentQ: 0,
            userAnswers: [],
            personalityScore: {},
            zodiacSign: '',
            partnerAnalysis: null
        };

        // ===== UTILITY FUNCTIONS =====
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function getZodiacSign(birthDate) {
            const date = new Date(birthDate);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const signs = Object.keys(zodiacSigns.ar);
            for (let sign of signs) {
                const [startMonth, startDay, endMonth, endDay] = zodiacSigns.ar[sign].dates;
                if ((month === startMonth && day >= startDay) || (month === endMonth && day <= endDay)) {
                    return sign;
                }
            }
            return 'الحمل';
        }

        function showToast(message, duration = 3000) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 400);
            }, duration);
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // ===== PERSONALITY ANALYSIS =====
        function analyzePersonality(answers) {
            const scores = {};
            const questionsData = questions[state.lang];
            answers.forEach((answerIndex, questionIndex) => {
                if (answerIndex !== undefined && questionsData[questionIndex]) {
                    const option = questionsData[questionIndex].options[answerIndex];
                    if (option && option.trait) {
                        const traits = option.trait.split(',');
                        traits.forEach(trait => {
                            trait = trait.trim();
                            scores[trait] = (scores[trait] || 0) + (option.score || 1);
                        });
                    }
                }
            });
            return scores;
        }

        function generatePersonalityAnalysis(answers, userData) {
            const scores = analyzePersonality(answers);
            const primaryTrait = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const t = translations[state.lang];

            const personalityTypes = {
                'D': {
                    name: 'القائد المهيمن (الأحمر)',
                    description: `أنت شخصية قيادية بطبيعتك، تمتلك إرادة قوية وتحب التحكم في الأمور. لا تهاب التحديات، وتميل إلى اتخاذ القرارات بسرعة وثقة. أنت موجه نحو النتائج، وتحب أن ترى تقدماً ملموساً. قد تبدو أحياناً حازماً أكثر من اللازم، لكن دافعك هو إحداث تأثير حقيقي.`
                },
                'I': {
                    name: 'الشخصية المؤثرة (الأصفر)',
                    description: `أنت شخصية اجتماعية، محبوبة، ومحفزة. تمتلك طاقة إيجابية عالية، وتحب أن تكون محور الاهتمام. تُحدث تأثيراً من خلال كلماتك وحماسك، وتميل إلى بناء العلاقات بسهولة. قد تفتقر أحياناً للتنظيم، لكنك تُكمل ذلك بقدرتك على إلهام الآخرين وتحفيزهم.`
                },
                'S': {
                    name: 'الشخصية المستقرة (الأخضر)',
                    description: `أنت شخصية هادئة، موثوقة، وداعمة. تكره التوتر والصراع، وتحب الاستقرار والانسجام. أنت صبور، وفيّ، وتحافظ على العلاقات لفترة طويلة. قد تقاوم التغيير في البداية، لكنك تُحدث تأثيراً عميقاً من خلال ولائك وثباتك.`
                },
                'C': {
                    name: 'الشخصية الواعية (الأزرق)',
                    description: `أنت شخصية تحليلية، دقيقة، ومنطقية. تهتم بالتفاصيل، وتسعى لتحقيق الجودة في كل ما تفعل. تتخذ قراراتك بناءً على التفكير العميق، وتحب أن يكون كل شيء منظمًا. قد تبدو بارداً أحياناً، لكن دافعك هو السعي نحو الكمال والدقة.`
                }
            };

            const mainType = personalityTypes[primaryTrait] || personalityTypes['D'];

            let html = `
                <div class="glass-card rounded-xl p-6 mb-6">
                    <h3 class="text-2xl font-bold gradient-text mb-4">تحليل شخصيتك</h3>
                    <p class="text-gray-300 mb-4">بناءً على إجاباتك، تم تحديد طبيعة شخصيتك على النحو التالي:</p>
                    <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg p-4 mb-4">
                        <h4 class="text-xl font-bold text-yellow-400 mb-2">${mainType.name}</h4>
                        <p class="text-gray-300 leading-relaxed">${mainType.description}</p>
                    </div>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-semibold text-green-400 mb-2">نقاط قوتك:</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${getStrengths(primaryTrait).map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-orange-400 mb-2">مجالات النمو:</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${getGrowthAreas(primaryTrait).map(g => `<li>${g}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            return { html, primaryTrait };
        }

        function getStrengths(trait) {
            const strengths = {
                'D': [
                    'اتخاذ قرارات سريعة وحاسمة',
                    'القدرة على قيادة الفرق بنجاح',
                    'التركيز على النتائج والإنجازات',
                    'الثقة بالنفس والجرأة في المواقف الصعبة'
                ],
                'I': [
                    'ممتاز في التواصل والتأثير',
                    'يُشعر الآخرين بالتحفيز والتقدير',
                    'مرونة عالية في التعامل مع التغيير',
                    'يُبقي الفريق في معنويات عالية'
                ],
                'S': [
                    'الاستماع الجيد وفهم مشاعر الآخرين',
                    'الوفاء والالتزام بالعلاقات',
                    'القدرة على تهدئة المواقف المتوترة',
                    'العمل الجماعي والانسجام مع الفريق'
                ],
                'C': [
                    'الدقة والانتباه للتفاصيل',
                    'التفكير المنطقي والتحليل العميق',
                    'الالتزام بالجودة والمواعيد',
                    'التنظيم الممتاز ووضع الخطط'
                ]
            };
            return strengths[trait] || strengths['D'];
        }

        function getGrowthAreas(trait) {
            const growth = {
                'D': [
                    'الاستماع أكثر لمشاعر الفريق',
                    'منح الآخرين مساحة لاتخاذ القرارات',
                    'التعامل بلطف مع من يختلفون معك',
                    'الاعتراف بالمشاعر بدل تجاهلها'
                ],
                'I': [
                    'التركيز على المهام بدلاً من الحديث عنها فقط',
                    'اتباع خطة منظمة للإنجاز',
                    'التعامل مع الانتقادات بعقلانية',
                    'العمل على تطوير الصبر والمثابرة'
                ],
                'S': [
                    'التحدث عن احتياجاتك بوضوح',
                    'اتخاذ موقف حاسم عند الضرورة',
                    'الانفتاح على التغيير والجديد',
                    'الاعتناء بنفسك أولاً قبل الآخرين'
                ],
                'C': [
                    'التحدث عن المشاعر بحرية',
                    'اتخاذ قرارات أسرع دون تردد مفرط',
                    'التعامل مع الأخطاء كفرص للتعلم',
                    'الثقة بالآخرين في إنجاز المهام'
                ]
            };
            return growth[trait] || growth['D'];
        }

        function generatePartnerAnalysis(userScores, userZodiac, userData) {
            const t = translations[state.lang];
            const userPrimaryTrait = Object.keys(userScores).reduce((a, b) => userScores[a] > userScores[b] ? a : b);

            const partnerTraits = {
                'D': {
                    idealPartner: 'I',
                    name: 'الشخصية المؤثرة (الأصفر)',
                    description: 'يحتاج القائد إلى شريك يوازن قوته بالدفء والتفاعل الاجتماعي، ويُكمل طاقته بالحماس والمرح.',
                    traits: ['مرح ومتفاعل', 'يقدر الإنجازات', 'مرن في التعامل', 'يشارك في الأهداف'],
                    advice: ['امنح شريكك مساحة للتعبير', 'تعلم الاستماع أكثر', 'اهتم بالجانب العاطفي']
                },
                'I': {
                    idealPartner: 'S',
                    name: 'الشخصية المستقرة (الأخضر)',
                    description: 'تحتاج الشخصية المؤثرة إلى شريك يوفر الاستقرار والأمان العاطفي، ويُكمل حماسك بالهدوء والولاء.',
                    traits: ['صبور ومتفهم', 'يقدر التفاعل الاجتماعي', 'مخلص وموثوق', 'يوفر الاستقرار'],
                    advice: ['قدر حاجة شريكك للهدوء', 'لا تضغط عليه للتغيير السريع', 'أظهر التقدير المستمر']
                },
                'S': {
                    idealPartner: 'I',
                    name: 'الشخصية المؤثرة (الأصفر)',
                    description: 'تحتاج الشخصية المستقرة إلى شريك يجلب الحيوية والطاقة للحياة، ويُكمل استقرارك بالحماس والتفاعل.',
                    traits: ['نشيط ومحفز', 'يجلب المرح', 'اجتماعي ومقبول', 'متفائل ومشجع'],
                    advice: ['كن صبوراً مع حاجة شريكك للوقت', 'شاركه في الأنشطة الاجتماعية', 'أظهر التقدير باستمرار']
                },
                'C': {
                    idealPartner: 'D',
                    name: 'القائد (الأحمر)',
                    description: 'تحتاج الشخصية الواعية إلى شريك يقدر دقتها ويوفر الدعم في اتخاذ القرارات، ويُكمل تحليلك بالجرأة والقيادة.',
                    traits: ['حاسم وواثق', 'يقدر الجودة', 'يتخذ قرارات سريعة', 'يوفر الحماية'],
                    advice: ['احترم حاجة شريكك للوقت في التفكير', 'قدر اهتمامه بالتفاصيل', 'كن واضحاً في التواصل']
                }
            };

            const partnerInfo = partnerTraits[userPrimaryTrait] || partnerTraits['D'];

            const zodiacCompatibility = {
                'الحمل': ['الأسد', 'القوس', 'الجوزاء', 'الدلو'],
                'الثور': ['العذراء', 'الجدي', 'السرطان', 'الحوت'],
                'الجوزاء': ['الميزان', 'الدلو', 'الحمل', 'الأسد'],
                'السرطان': ['العقرب', 'الحوت', 'الثور', 'العذراء'],
                'الأسد': ['الحمل', 'القوس', 'الجوزاء', 'الميزان'],
                'العذراء': ['الثور', 'الجدي', 'السرطان', 'العقرب'],
                'الميزان': ['الجوزاء', 'الدلو', 'الأسد', 'القوس'],
                'العقرب': ['السرطان', 'الحوت', 'العذراء', 'الجدي'],
                'القوس': ['الحمل', 'الأسد', 'الميزان', 'الدلو'],
                'الجدي': ['الثور', 'العذراء', 'العقرب', 'الحوت'],
                'الدلو': ['الجوزاء', 'الميزان', 'القوس', 'الحمل'],
                'الحوت': ['السرطان', 'العقرب', 'الجدي', 'الثور']
            };

            const compatibleSigns = zodiacCompatibility[userZodiac] || [];
            const primaryCompatibleSign = compatibleSigns[0] || 'الحمل';
            const personalityCompatibility = compatibilityMatrix[userPrimaryTrait]?.[partnerInfo.idealPartner] || 80;
            const zodiacCompatibilityScore = 85;
            const overallScore = Math.round((personalityCompatibility + zodiacCompatibilityScore) / 2);

            return {
                partnerPersonality: partnerInfo,
                compatibleZodiacSigns: compatibleSigns,
                primaryZodiacMatch: primaryCompatibleSign,
                compatibilityScore: overallScore,
                personalityScore: personalityCompatibility,
                zodiacScore: zodiacCompatibilityScore
            };
        }

        // ===== RENDER RESULT =====
        function renderResult() {
            const t = translations[state.lang];
            const { html: personalityHtml, primaryTrait } = generatePersonalityAnalysis(state.userAnswers, state.userData);
            const zodiacSign = getZodiacSign(state.userData.dob);
            const partnerAnalysis = generatePartnerAnalysis(state.personalityScore, zodiacSign, state.userData);

            return `
                <div class="animate-fade-in space-y-8">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold gradient-text mb-2">${t.welcome_title}</h2>
                        <p class="text-gray-300">تحليل شامل لشخصيتك وشريك حياتك المثالي</p>
                    </div>

                    ${personalityHtml}

                    <div class="glass-card rounded-xl p-6 mb-6">
                        <h3 class="text-2xl font-bold gradient-text mb-4">${t.partner_analysis_title}</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-xl font-bold text-pink-400 mb-3">نوع شخصية الشريك المثالي:</h4>
                                <p class="text-gray-300 mb-4">${partnerAnalysis.partnerPersonality.name}</p>
                                <p class="text-gray-300 mb-4">${partnerAnalysis.partnerPersonality.description}</p>
                                <h5 class="font-semibold text-green-400 mb-2">صفاته المثالية:</h5>
                                <ul class="list-disc list-inside text-gray-300 space-y-1">
                                    ${partnerAnalysis.partnerPersonality.traits.map(trait => `<li>${trait}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold text-blue-400 mb-3">التوافق الفلكي مع برجك:</h4>
                                <p class="text-gray-300 mb-2"><strong>برجك:</strong> ${zodiacSign}</p>
                                <p class="text-gray-300 mb-2"><strong>البرج الأكثر توافقًا:</strong> ${partnerAnalysis.primaryZodiacMatch}</p>
                                <p class="text-gray-300 mb-4">الأبراج المتوافقة: ${partnerAnalysis.compatibleZodiacSigns.slice(0, 4).join('، ')}</p>
                                <div class="text-center mb-4">
                                    <div class="compatibility-score">${partnerAnalysis.compatibilityScore}%</div>
                                    <p class="text-sm text-gray-400">نسبة التوافق الكلية</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6">
                            <h5 class="font-semibold text-blue-400 mb-2">نصائح للعلاقة:</h5>
                            <ul class="list-disc list-inside text-gray-300 space-y-1">
                                ${partnerAnalysis.partnerPersonality.advice.map(advice => `<li>${advice}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-4 justify-center">
                        <button id="restartBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            <i class="fas fa-redo mr-2"></i>${t.restart_btn}
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== RENDER FUNCTIONS =====
        function render() {
            const t = translations[state.lang];
            document.documentElement.lang = state.lang;
            document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr';
            let html = `
                <div class="fixed top-4 right-4 z-50">
                    <button id="langToggle" class="bg-yellow-400 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">
                        ${state.lang === 'ar' ? 'EN' : 'AR'}
                    </button>
                </div>
            `;

            switch (state.page) {
                case 'userInfo':
                    html += renderUserInfo();
                    break;
                case 'intro':
                    html += renderIntro();
                    break;
                case 'quiz':
                    html += renderQuiz();
                    break;
                case 'result':
                    html += renderResult();
                    break;
            }

            html += `
                <footer class="mt-16 text-center text-gray-400 space-y-2">
                    <p class="font-semibold">جميع الحقوق محفوظة © ${new Date().getFullYear()} | تم التصميم والتطوير بواسطة <strong>Mohammed Tarek</strong></p>
                    <p>${t.footer2}</p>
                </footer>
            `;

            document.getElementById('app').innerHTML = html;
            setupEventListeners();
        }

        function renderUserInfo() {
            const t = translations[state.lang];
            return `
                <div class="animate-fade-in">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold gradient-text mb-4">${t.welcome_title}</h1>
                        <p class="text-gray-300 text-lg">اكتشف شخصيتك الحقيقية ورفيق دربك المثالي</p>
                    </div>
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="lg:w-1/3">
                            <div id="ageCard" class="glass-card rounded-2xl p-6 text-center border-2 border-yellow-400/30">
                                <div class="text-lg font-semibold mb-2">${t.age_label}</div>
                                <div id="calculatedAge" class="text-5xl font-bold gradient-text mb-2">
                                    ${state.userData.age || '-'}
                                </div>
                                <div class="text-gray-400">سنة</div>
                            </div>
                        </div>
                        <div class="lg:w-2/3">
                            <div class="glass-card rounded-xl p-6">
                                <h3 class="text-2xl font-bold mb-4">${t.user_info_title}</h3>
                                <p class="text-gray-300 mb-6">${t.user_info_desc}</p>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${t.gender_label}</label>
                                        <select id="gender" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:border-yellow-400 focus:outline-none">
                                            <option value="">اختر الجنس</option>
                                            <option value="male" ${state.userData.gender === 'male' ? 'selected' : ''}>${t.male}</option>
                                            <option value="female" ${state.userData.gender === 'female' ? 'selected' : ''}>${t.female}</option>
                                            <option value="other" ${state.userData.gender === 'other' ? 'selected' : ''}>${t.other}</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">${t.dob_label}</label>
                                        <input type="date" id="dob" value="${state.userData.dob || ''}" 
                                               class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:border-yellow-400 focus:outline-none">
                                    </div>
                                    <button id="submitUserInfo" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-slate-900 font-bold py-3 px-6 rounded-lg hover:from-yellow-500 hover:to-orange-600 transition-all transform hover:scale-105">
                                        ${t.submit_user_info}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIntro() {
            const t = translations[state.lang];
            return `
                <div class="animate-fade-in text-center">
                    <div class="glass-card rounded-xl p-8 max-w-3xl mx-auto">
                        <h1 class="text-4xl font-bold gradient-text mb-4">${t.intro_title}</h1>
                        <h2 class="text-2xl font-semibold text-purple-400 mb-6">${t.intro_subtitle}</h2>
                        <div class="w-32 h-1 bg-gradient-to-r from-yellow-400 to-purple-500 mx-auto mb-8"></div>
                        <div class="space-y-4 text-gray-300 text-lg mb-8">
                            <p>${t.intro_desc}</p>
                            <p>${t.intro_p1}</p>
                            <p>${t.intro_p2}</p>
                        </div>
                        <button id="startBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-8 rounded-lg text-xl hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105">
                            <i class="fas fa-rocket mr-2"></i>${t.start_btn}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            const t = translations[state.lang];
            const questionsData = questions[state.lang];
            const q = questionsData[state.currentQ];
            const progress = Math.floor((state.currentQ / questionsData.length) * 100);
            return `
                <div class="animate-fade-in">
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">${t.progress}</span>
                            <span class="text-sm font-semibold">${state.currentQ + 1} / ${questionsData.length}</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-3">
                            <div class="progress-bar h-3 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <div class="glass-card rounded-xl p-6 mb-6">
                        <h3 class="text-2xl font-bold mb-6 text-center">${state.currentQ + 1}. ${q.text}</h3>
                        <div class="space-y-3">
                            ${q.options.map((opt, idx) => `
                                <button class="option-btn w-full p-4 rounded-lg text-right transition-all ${
                                    state.userAnswers[state.currentQ] === idx ? 'selected' : ''
                                }" data-opt="${idx}">
                                    <div class="flex items-center justify-between">
                                        <i class="fas fa-circle text-xs ${state.userAnswers[state.currentQ] === idx ? 'text-yellow-400' : 'text-gray-500'}"></i>
                                        <span>${opt.text}</span>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                        <button id="nextBtn" class="w-full mt-6 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all">
                            ${state.currentQ === questionsData.length - 1 ? 'عرض النتائج' : t.next_btn}
                            <i class="fas fa-arrow-left mr-2"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
            document.addEventListener('click', handleClick);
            const dobInput = document.getElementById('dob');
            if (dobInput) {
                dobInput.addEventListener('input', function() {
                    const date = this.value;
                    if (date && new Date(date) <= new Date()) {
                        const age = calculateAge(date);
                        document.getElementById('calculatedAge').textContent = age;
                        state.userData.dob = date;
                        state.userData.age = age.toString();
                    } else {
                        document.getElementById('calculatedAge').textContent = '-';
                        state.userData.dob = '';
                        state.userData.age = '';
                        if (date) showToast('تاريخ ميلاد غير صحيح');
                    }
                });
            }
            const genderSelect = document.getElementById('gender');
            if (genderSelect) {
                genderSelect.addEventListener('change', function() {
                    state.userData.gender = this.value;
                });
            }
        }

        function handleClick(e) {
            const t = translations[state.lang];
            if (e.target.id === 'langToggle') {
                state.lang = state.lang === 'ar' ? 'en' : 'ar';
                render();
            }
            if (e.target.id === 'submitUserInfo') {
                const { age, gender, dob } = state.userData;
                if (!age || !gender || !dob) {
                    showToast(t.alert_missing_fields);
                    return;
                }
                state.page = 'intro';
                render();
            }
            if (e.target.id === 'startBtn') {
                state.page = 'quiz';
                state.currentQ = 0;
                state.userAnswers = [];
                render();
            }
            if (e.target.classList.contains('option-btn')) {
                const idx = parseInt(e.target.getAttribute('data-opt'));
                state.userAnswers[state.currentQ] = idx;
                render();
            }
            if (e.target.id === 'nextBtn') {
                const questionsData = questions[state.lang];
                if (state.userAnswers[state.currentQ] === undefined) {
                    showToast(t.alert_no_answer);
                    return;
                }
                if (state.currentQ < questionsData.length - 1) {
                    state.currentQ++;
                    render();
                } else {
                    state.personalityScore = analyzePersonality(state.userAnswers);
                    state.page = 'result';
                    render();
                }
            }
            if (e.target.id === 'restartBtn') {
                state = {
                    lang: state.lang,
                    page: 'userInfo',
                    userData: { age: '', gender: '', dob: '' },
                    currentQ: 0,
                    userAnswers: [],
                    personalityScore: {},
                    zodiacSign: '',
                    partnerAnalysis: null
                };
                render();
            }
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });
    </script>
</body>
</html>
