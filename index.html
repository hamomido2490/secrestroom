<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>غرفة الأسرار | Chamber of Secrets</title>

    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: white;
        }
        .gradient-text {
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        .option-btn {
            display: block;
            width: 100%;
            text-align: right;
            padding: 16px;
            margin: 8px 0;
            background: rgba(30, 41, 59, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .option-btn:hover, .option-btn.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(8px);
        }
        .progress-bar {
            height: 8px;
            background: #334155;
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 999px;
            transition: width 0.4s ease;
        }
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            border: 1px solid #334155;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            z-index: 1000;
            opacity: 0;
            animation: toastSlide 0.4s ease forwards;
        }
        @keyframes toastSlide {
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        .ad-banner {
            background: linear-gradient(45deg, #f59e0b, #ef4444);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .ad-banner:hover { transform: scale(1.02); }
        .star-rating { color: #fbbf24; }
        .settings-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .settings-panel {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            color: white;
        }
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #334155;
            border-radius: 999px;
            cursor: pointer;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        .toggle-switch.checked {
            background: #3b82f6;
        }
        .toggle-switch.checked::after {
            transform: translateX(26px);
        }
        @media print {
            body { background: white !important; color: black !important; }
            .glass-card { background: white !important; border: 1px solid #ccc !important; }
            .ad-banner, .btn-primary, .btn-secondary, #settingsBtn, #langToggle { display: none !important; }
        }
    </style>
</head>
<body class="text-white">
    <div id="app" class="container mx-auto px-4 py-8 max-w-4xl"></div>
    <div id="toast"></div>
    <div id="settingsOverlay" class="settings-overlay">
        <div class="settings-panel">
            <h3 class="text-xl font-bold gradient-text mb-4">إعدادات الإدارة</h3>
            <div id="passwordSection">
                <label class="block mb-2">كلمة المرور</label>
                <input type="password" id="adminPassword" class="w-full px-3 py-2 bg-slate-700 rounded border border-slate-600" placeholder="أدخل كلمة المرور">
                <button id="loginBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 mt-2 rounded">دخول</button>
            </div>
            <div id="adminPanel" style="display: none;">
                <h4 class="font-semibold mb-3">عرض الإعلانات</h4>
                <div class="flex justify-between items-center mb-3">
                    <span>أعلى الصفحة</span>
                    <div class="toggle-switch" id="topToggle"></div>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <span>جانب الصفحة</span>
                    <div class="toggle-switch" id="sideToggle"></div>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <span>أسفل الصفحة</span>
                    <div class="toggle-switch" id="bottomToggle"></div>
                </div>
                <button id="saveSettings" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded mt-4">حفظ الإعدادات</button>
                <button id="closeSettings" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded mt-2">إغلاق</button>
            </div>
        </div>
    </div>

    <script>
        // ====== الحالة والبيانات ======
        const state = {
            currentQ: 0,
            userAnswers: [],
            userData: { age: null, gender: '', dob: '' },
            lang: 'ar',
            page: 'userInfo',
            showReviewForm: false,
            resultText: ''
        };

        // ====== إعدادات الإعلانات ======
        const adZones = {
            top: `<div class="ad-banner" onclick="openAd('top')">إعلانك هنا (أعلى)</div>`,
            side: `<div class="ad-banner" onclick="openAd('side')">إعلانك هنا (جانبي)</div>`,
            bottom: `<div class="ad-banner" onclick="openAd('bottom')">إعلانك هنا (أسفل)</div>`
        };

        function openAd(zone) {
            alert(`تم النقر على إعلان المنطقة: ${zone}`);
            // مثال: window.open('https://your-affiliate-link.com', '_blank');
        }

        // ====== الترجمات ======
        const translations = {
            ar: {
                welcome_title: "مرحباً في غرفة الأسرار",
                user_info_title: "معلوماتك الشخصية",
                user_info_desc: "دعنا نتعرف عليك أكثر لنقدم لك تحليلاً دقيقاً",
                age_label: "العمر",
                gender_label: "الجنس",
                dob_label: "تاريخ الميلاد",
                submit_user_info: "التالي",
                intro_title: "استعد لرحلة اكتشاف الذات",
                intro_subtitle: "تحليل شخصيتك ومعرفة رفيق دربك",
                intro_desc: "ستخوض رحلة من 20 سؤالاً مصممة خصيصاً لكشف أعماق شخصيتك",
                intro_p1: "سنحلل شخصيتك وفقاً لأحدث النظريات النفسية",
                intro_p2: "وسنساعدك في اكتشاف الشريك المثالي لك",
                start_btn: "ابدأ الرحلة",
                progress: "التقدم:",
                next_btn: "التالي",
                final_results_btn: "عرض النتائج",
                restart_btn: "ابدأ من جديد",
                share_btn: "مشاركة النتيجة",
                copy_btn: "نسخ النتيجة",
                alert_missing_fields: "يرجى ملء جميع الحقول",
                alert_invalid_dob: "تاريخ ميلاد غير صحيح",
                alert_no_answer: "يرجى اختيار إجابة",
                alert_copied: "تم نسخ النتيجة بنجاح!",
                footer1: "جميع الحقوق محفوظة © 2025| تم التصميم والتطوير بواسطة <strong>Mohammed Tarek</strong>",
                footer2: "مطور بحب ❤️ لمساعدتك في فهم نفسك أكثر",
                male: "ذكر",
                female: "أنثى",
                other: "آخر",
                compatibility_title: "نسبة التوافق",
                partner_traits: "صفات الشريك المثالي",
                relationship_advice: "نصائح للعلاقة",
                analysis_intro: "بعد تحليل إجاباتك، تم تحديد طبيعة شخصيتك على النحو التالي:",
                personality_section: "تحليل شخصيتك",
                partner_section: "الشريك المثالي لك",
                partner_analysis_title: "تحليل مفصل للشريك المثالي",
                visitors_count: "عدد الزوار",
                analysis_count: "تحليلات شخصية",
                settings: "الإعدادات",
                enable_ads: "تفعيل الإعلانات",
                language: "اللغة",
                review_rating: "تقييمك",
                review_comment: "تعليقك",
                submit_review: "إرسال التقييم",
                your_reviews: "تقييمات المستخدمين"
            },
            en: {
                welcome_title: "Welcome to Chamber of Secrets",
                user_info_title: "Your Personal Information",
                user_info_desc: "Let us know you better to provide accurate analysis",
                age_label: "Age",
                gender_label: "Gender",
                dob_label: "Date of Birth",
                submit_user_info: "Next",
                intro_title: "Get Ready for a Journey of Self-Discovery",
                intro_subtitle: "Analyze Your Personality & Find Your Ideal Partner",
                intro_desc: "You will take a 20-question journey designed to uncover the depths of your personality",
                intro_p1: "We will analyze your personality using the latest psychological theories",
                intro_p2: "And help you discover your ideal partner",
                start_btn: "Start Journey",
                progress: "Progress:",
                next_btn: "Next",
                final_results_btn: "Show Results",
                restart_btn: "Start Over",
                share_btn: "Share Result",
                copy_btn: "Copy Result",
                alert_missing_fields: "Please fill all fields",
                alert_invalid_dob: "Invalid date of birth",
                alert_no_answer: "Please select an answer",
                alert_copied: "Result copied successfully!",
                footer1: "All rights reserved © 2025| Designed and developed by <strong>Mohammed Tarek</strong>",
                footer2: "Developed with love ❤️ to help you understand yourself better",
                male: "Male",
                female: "Female",
                other: "Other",
                compatibility_title: "Compatibility Rate",
                partner_traits: "Ideal Partner Traits",
                relationship_advice: "Relationship Advice",
                analysis_intro: "After analyzing your answers, your personality type is:",
                personality_section: "Your Personality Analysis",
                partner_section: "Your Ideal Partner",
                partner_analysis_title: "Detailed Partner Analysis",
                visitors_count: "Visitors",
                analysis_count: "Personality Analyses",
                settings: "Settings",
                enable_ads: "Enable Ads",
                language: "Language",
                review_rating: "Your Rating",
                review_comment: "Your Comment",
                submit_review: "Submit Review",
                your_reviews: "User Reviews"
            }
        };

        // ====== الأسئلة ======
        const questions = {
            ar: [
                { id: 1, text: "عندما تستيقظ في الصباح، ما أول شيء يخطر ببالك؟", options: [
                    { text: "أنا متحمس لأبدأ يومي!", trait: "I", score: 4 },
                    { text: "هل كل شيء تحت السيطرة؟", trait: "C", score: 3 },
                    { text: "هل سأكون كافيًا اليوم؟", trait: "S", score: 2 },
                    { text: "أريد أن أفهم معنى هذا اليوم", trait: "C", score: 3 }
                ]},
                { id: 2, text: "في لقاء اجتماعي جديد، ماذا تفعل؟", options: [
                    { text: "أبدأ الحديث مع الجميع بسرعة", trait: "I", score: 4 },
                    { text: "أراقب أولًا ثم أتحدث مع شخص واحد", trait: "S", score: 4 },
                    { text: "أركز على من يمكن أن يفيدني أو أفيد منه", trait: "D", score: 3 },
                    { text: "أحاول فهم مشاعر الآخرين بسرعة", trait: "S", score: 4 }
                ]},
                { id: 3, text: "ما نوع المهمة التي تجعلك 'تُنسى' من نفسك؟", options: [
                    { text: "التحديات السريعة والملتزمة بالوقت", trait: "D", score: 4 },
                    { text: "التحليل العميق للبيانات أو الأنظمة", trait: "C", score: 4 },
                    { text: "مساعدة شخص على تجاوز أزمة", trait: "S", score: 4 },
                    { text: "تنظيم فريق لتحقيق هدف منظم", trait: "I", score: 3 }
                ]},
                { id: 4, text: "ما أكثر شيء تبحث عنه في الصداقات؟", options: [
                    { text: "المرح والطاقة", trait: "I", score: 4 },
                    { text: "الولاء والاستقرار", trait: "S", score: 4 },
                    { text: "العمق والمعنى", trait: "C", score: 4 },
                    { text: "التحدي الفكري", trait: "D", score: 3 }
                ]},
                { id: 5, text: "كيف تتعامل مع الأخطاء؟", options: [
                    { text: "أتعلم وأتحرك بسرعة", trait: "D", score: 4 },
                    { text: "أحلل ما حدث بدقة", trait: "C", score: 4 },
                    { text: "أشعر بالذنب، لكنني أسامح نفسي", trait: "S", score: 3 },
                    { text: "أتساءل: هل هذا يثبت أنني غير كافٍ؟", trait: "S", score: 2 }
                ]},
                { id: 6, text: "ما الذي يُشعرك بالفخر؟", options: [
                    { text: "تحقيق نتائج ملموسة", trait: "D", score: 4 },
                    { text: "دعم شخص في أزمة", trait: "S", score: 4 },
                    { text: "ابتكار فكرة جديدة", trait: "I", score: 4 },
                    { text: "الالتزام بالواجبات والمسؤوليات", trait: "C", score: 3 }
                ]},
                { id: 7, text: "ما الذي تبحث عنه في قرار مهم؟", options: [
                    { text: "السرعة والنتائج", trait: "D", score: 4 },
                    { text: "الإلهام والانطباع الأول", trait: "I", score: 3 },
                    { text: "استقرار الفريق والعلاقات", trait: "S", score: 4 },
                    { text: "التحليل العميق والمنطق", trait: "C", score: 4 }
                ]},
                { id: 8, text: "ماذا تفعل عندما تشعر بالضغط؟", options: [
                    { text: "أتحدى الموقف مباشرة", trait: "D", score: 4 },
                    { text: "أبحث عن دعم من الآخرين", trait: "I", score: 3 },
                    { text: "أبتعد مؤقتًا لأعيد التفكير", trait: "S", score: 3 },
                    { text: "أحلل المشكلة من كل الزوايا", trait: "C", score: 4 }
                ]},
                { id: 9, text: "ما نوع الكتب أو المحتوى الذي تفضله؟", options: [
                    { text: "قصص نجاح، قيادة، تأثير", trait: "D", score: 4 },
                    { text: "روايات، فلسفة، تأملات وجودية", trait: "C", score: 4 },
                    { text: "نكت، فيديوهات مضحكة، ترفيه", trait: "I", score: 3 },
                    { text: "أدلة عملية، خطوات، تقنيات", trait: "S", score: 3 }
                ]},
                { id: 10, text: "ما الذي يعطيك إحساسًا بالمعنى؟", options: [
                    { text: "تحقيق إنجازات كبيرة", trait: "D", score: 4 },
                    { text: "خدمة الآخرين", trait: "S", score: 4 },
                    { text: "فهم الكون أو النظام الكوني", trait: "C", score: 4 },
                    { text: "الاستقرار والانتماء", trait: "S", score: 3 }
                ]},
                { id: 11, text: "كم مرة تغير رأيك بناءً على معلومة جديدة؟", options: [
                    { text: "نادرًا، أنا واثق من قراراتي", trait: "D", score: 4 },
                    { text: "أحيانًا، إذا كانت الحجة قوية", trait: "C", score: 4 },
                    { text: "غالبًا، لأنني أحب التعلم", trait: "I", score: 4 },
                    { text: "دائمًا، لأنني أكره التصلب", trait: "I", score: 3 }
                ]},
                { id: 12, text: "ما الذي يُشعرك بالراحة؟", options: [
                    { text: "تحقيق الهدف", trait: "D", score: 4 },
                    { text: "الضحك والتفاعل", trait: "I", score: 4 },
                    { text: "الهدوء والاستقرار", trait: "S", score: 4 },
                    { text: "النظام والفهم الكامل", trait: "C", score: 4 }
                ]},
                { id: 13, text: "ما هو شعارك في الحياة؟", options: [
                    { text: "النتيجة أهم من الطريقة", trait: "D", score: 4 },
                    { text: "الحياة للمرح والتجربة", trait: "I", score: 4 },
                    { text: "العلاقات تُبنى بالصبر والوفاء", trait: "S", score: 4 },
                    { text: "الفهم يسبق كل شيء", trait: "C", score: 4 }
                ]},
                { id: 14, text: "كيف تتعامل مع الانتقاد؟", options: [
                    { text: "أتحداه وأثبت نفسي", trait: "D", score: 4 },
                    { text: "أضحك وأحوله إلى نكتة", trait: "I", score: 3 },
                    { text: "أتألم لكنني أتعلم", trait: "S", score: 3 },
                    { text: "أحلله وأستفيد منه", trait: "C", score: 4 }
                ]},
                { id: 15, text: "ما نوع القيادة التي تُلهمك؟", options: [
                    { text: "قيادة حاسمة وسريعة", trait: "D", score: 3 },
                    { text: "قيادة ملهمة ومحفزة", trait: "I", score: 3 },
                    { text: "قيادة داعمة ومستقرة", trait: "S", score: 3 },
                    { text: "قيادة منظمة وتحليلية", trait: "C", score: 3 }
                ]},
                { id: 16, text: "ما الذي يُشعرك بالإنجاز؟", options: [
                    { text: "إكمال مهمة صعبة", trait: "D", score: 4 },
                    { text: "رؤية الآخرين سعداء بعملي", trait: "I", score: 4 },
                    { text: "الحفاظ على التوازن والانسجام", trait: "S", score: 4 },
                    { text: "اتباع نظام دقيق", trait: "C", score: 4 }
                ]},
                { id: 17, text: "ما الذي يُشعرك بالحرية؟", options: [
                    { text: "التحكم في مصيري", trait: "D", score: 4 },
                    { text: "التعبير عن نفسي بحرية", trait: "I", score: 4 },
                    { text: "العيش بسلام مع نفسي", trait: "S", score: 4 },
                    { text: "الفهم العميق للعالم", trait: "C", score: 4 }
                ]},
                { id: 18, text: "كيف تتعامل مع التغيير؟", options: [
                    { text: "أتحداه وأقوده", trait: "D", score: 4 },
                    { text: "أحتفل به وانغمس فيه", trait: "I", score: 4 },
                    { text: "أتأقلم ببطء وحذر", trait: "S", score: 3 },
                    { text: "أحلله وأفهمه أولًا", trait: "C", score: 4 }
                ]},
                { id: 19, text: "ما الذي يحفزك للاستمرار؟", options: [
                    { text: "تحقيق أهدافي الشخصية", trait: "D", score: 4 },
                    { text: "إسعاد الآخرين ورؤيتهم يبتسمون", trait: "I", score: 4 },
                    { text: "الحفاظ على الاستقرار والأمان", trait: "S", score: 4 },
                    { text: "فهم الحقيقة والوصول للكمال", trait: "C", score: 4 }
                ]},
                { id: 20, text: "ما هو أسلوبك في حل المشاكل؟", options: [
                    { text: "أتخذ قرارات سريعة وأتحمل المسؤولية", trait: "D", score: 4 },
                    { text: "أبحث عن آراء الآخرين وأبني حلول جماعية", trait: "I", score: 4 },
                    { text: "أتأنى وأفكر في تأثير الحل على الجميع", trait: "S", score: 4 },
                    { text: "أبحث وأحلل حتى أجد الحل الأمثل", trait: "C", score: 4 }
                ]}
            ],
            en: [
                { id: 1, text: "When you wake up in the morning, what's the first thing on your mind?", options: [
                    { text: "I'm excited to start my day!", trait: "I", score: 4 },
                    { text: "Is everything under control?", trait: "C", score: 3 },
                    { text: "Will I be enough today?", trait: "S", score: 2 },
                    { text: "I want to understand the meaning of this day", trait: "C", score: 3 }
                ]},
                { id: 2, text: "At a new social gathering, what do you do?", options: [
                    { text: "I start talking to everyone quickly", trait: "I", score: 4 },
                    { text: "I observe first, then talk to one person", trait: "S", score: 4 },
                    { text: "I focus on who can benefit me or I can benefit", trait: "D", score: 3 },
                    { text: "I try to understand others' feelings quickly", trait: "S", score: 4 }
                ]},
                { id: 3, text: "What kind of task makes you 'lose yourself'?", options: [
                    { text: "Fast-paced, time-bound challenges", trait: "D", score: 4 },
                    { text: "Deep analysis of data or systems", trait: "C", score: 4 },
                    { text: "Helping someone overcome a crisis", trait: "S", score: 4 },
                    { text: "Organizing a team to achieve a structured goal", trait: "I", score: 3 }
                ]},
                { id: 4, text: "What do you look for most in friendships?", options: [
                    { text: "Fun and energy", trait: "I", score: 4 },
                    { text: "Loyalty and stability", trait: "S", score: 4 },
                    { text: "Depth and meaning", trait: "C", score: 4 },
                    { text: "Intellectual challenge", trait: "D", score: 3 }
                ]},
                { id: 5, text: "How do you handle mistakes?", options: [
                    { text: "I learn and move on quickly.", trait: "D", score: 4 },
                    { text: "I analyze what happened in detail.", trait: "C", score: 4 },
                    { text: "I feel guilty, but I forgive myself.", trait: "S", score: 3 },
                    { text: "I wonder: does this prove I'm not good enough?", trait: "S", score: 2 }
                ]},
                { id: 6, text: "What makes you feel proud?", options: [
                    { text: "Achieving tangible results.", trait: "D", score: 4 },
                    { text: "Supporting someone in a crisis.", trait: "S", score: 4 },
                    { text: "Innovating a new idea.", trait: "I", score: 4 },
                    { text: "Sticking to duties and responsibilities.", trait: "C", score: 3 }
                ]},
                { id: 7, text: "What do you look for in an important decision?", options: [
                    { text: "Speed and results", trait: "D", score: 4 },
                    { text: "Inspiration and first impression", trait: "I", score: 3 },
                    { text: "Team stability and relationships", trait: "S", score: 4 },
                    { text: "Deep analysis and logic", trait: "C", score: 4 }
                ]},
                { id: 8, text: "What do you do when you feel stressed?", options: [
                    { text: "I confront the situation directly", trait: "D", score: 4 },
                    { text: "I seek support from others", trait: "I", score: 3 },
                    { text: "I step back temporarily to rethink", trait: "S", score: 3 },
                    { text: "I analyze the problem from all angles", trait: "C", score: 4 }
                ]},
                { id: 9, text: "What type of books or content do you prefer?", options: [
                    { text: "Success stories, leadership, influence", trait: "D", score: 4 },
                    { text: "Novels, philosophy, existential reflections", trait: "C", score: 4 },
                    { text: "Jokes, funny videos, entertainment", trait: "I", score: 3 },
                    { text: "Practical guides, steps, techniques", trait: "S", score: 3 }
                ]},
                { id: 10, text: "What gives you a sense of meaning?", options: [
                    { text: "Achieving great accomplishments", trait: "D", score: 4 },
                    { text: "Serving others", trait: "S", score: 4 },
                    { text: "Understanding the universe or cosmic system", trait: "C", score: 4 },
                    { text: "Stability and belonging", trait: "S", score: 3 }
                ]},
                { id: 11, text: "How often do you change your mind based on new information?", options: [
                    { text: "Rarely, I'm confident in my decisions", trait: "D", score: 4 },
                    { text: "Sometimes, if the argument is strong", trait: "C", score: 4 },
                    { text: "Often, because I love learning", trait: "I", score: 4 },
                    { text: "Always, because I hate rigidity", trait: "I", score: 3 }
                ]},
                { id: 12, text: "What makes you feel comfortable?", options: [
                    { text: "Achieving the goal", trait: "D", score: 4 },
                    { text: "Laughing and interacting", trait: "I", score: 4 },
                    { text: "Calm and stability", trait: "S", score: 4 },
                    { text: "Order and complete understanding", trait: "C", score: 4 }
                ]},
                { id: 13, text: "What is your motto in life?", options: [
                    { text: "The result is more important than the method.", trait: "D", score: 4 },
                    { text: "Life is for fun and experience.", trait: "I", score: 4 },
                    { text: "Relationships are built with patience and loyalty.", trait: "S", score: 4 },
                    { text: "Understanding precedes everything.", trait: "C", score: 4 }
                ]},
                { id: 14, text: "How do you handle criticism?", options: [
                    { text: "I challenge it and prove myself", trait: "D", score: 4 },
                    { text: "I laugh and turn it into a joke", trait: "I", score: 3 },
                    { text: "I hurt but I learn", trait: "S", score: 3 },
                    { text: "I analyze it and benefit from it", trait: "C", score: 4 }
                ]},
                { id: 15, text: "What type of leadership inspires you?", options: [
                    { text: "Decisive and fast leadership", trait: "D", score: 3 },
                    { text: "Inspiring and motivating leadership", trait: "I", score: 3 },
                    { text: "Supportive and stable leadership", trait: "S", score: 3 },
                    { text: "Organized and analytical leadership", trait: "C", score: 3 }
                ]},
                { id: 16, text: "What makes you feel accomplished?", options: [
                    { text: "Completing a difficult task", trait: "D", score: 4 },
                    { text: "Seeing others happy with my work", trait: "I", score: 4 },
                    { text: "Maintaining balance and harmony", trait: "S", score: 4 },
                    { text: "Following a precise system", trait: "C", score: 4 }
                ]},
                { id: 17, text: "What makes you feel free?", options: [
                    { text: "Controlling my destiny", trait: "D", score: 4 },
                    { text: "Expressing myself freely", trait: "I", score: 4 },
                    { text: "Living in peace with myself", trait: "S", score: 4 },
                    { text: "Deep understanding of the world", trait: "C", score: 4 }
                ]},
                { id: 18, text: "How do you deal with change?", options: [
                    { text: "I challenge it and lead it", trait: "D", score: 4 },
                    { text: "I celebrate it and dive into it", trait: "I", score: 4 },
                    { text: "I adapt slowly and cautiously", trait: "S", score: 3 },
                    { text: "I analyze and understand it first", trait: "C", score: 4 }
                ]},
                { id: 19, text: "What motivates you to keep going?", options: [
                    { text: "Achieving my personal goals", trait: "D", score: 4 },
                    { text: "Making others happy and seeing them smile", trait: "I", score: 4 },
                    { text: "Maintaining stability and safety", trait: "S", score: 4 },
                    { text: "Understanding truth and reaching perfection", trait: "C", score: 4 }
                ]},
                { id: 20, text: "What is your approach to solving problems?", options: [
                    { text: "I make quick decisions and take responsibility", trait: "D", score: 4 },
                    { text: "I seek others' opinions and build collective solutions", trait: "I", score: 4 },
                    { text: "I take my time and consider the impact on everyone", trait: "S", score: 4 },
                    { text: "I research and analyze until I find the optimal solution", trait: "C", score: 4 }
                ]}
            ]
        };

        // ====== التحليل ======
        function analyzePersonality() {
            const scores = { D: 0, I: 0, S: 0, C: 0 };
            state.userAnswers.forEach((answerIndex, index) => {
                const q = questions[state.lang][index];
                if (q && q.options[answerIndex]) {
                    scores[q.options[answerIndex].trait] += q.options[answerIndex].score;
                }
            });
            const primary = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            return { scores, primary };
        }

        // ====== عرض النتائج ======
        function renderResult() {
            const { scores, primary } = analyzePersonality();
            const t = translations[state.lang];
            const types = {
                ar: { D: "القائد المهيمن", I: "الشخصية المؤثرة", S: "الشخصية المستقرة", C: "الشخصية الواعية" },
                en: { D: "The Dominant Leader", I: "The Influencer", S: "The Steady Supporter", C: "The Conscientious Thinker" }
            };
            const desc = {
                ar: { D: "أنت قيادي بطبيعتك، تحب التحكم والنتائج.", I: "أنت اجتماعي، متفائل، ومحب للضوء.", S: "أنت مستقر، ودود، وداعم للآخرين.", C: "أنت تحليلي، دقيق، وتكره الأخطاء." },
                en: { D: "You are a natural leader who loves control and results.", I: "You are social, optimistic, and love the spotlight.", S: "You are stable, friendly, and supportive.", C: "You are analytical, precise, and hate mistakes." }
            };

            const resultSummary = `
            <div class="animate-fade-in">
                <div class="glass-card rounded-xl p-8">
                    <h2 class="text-3xl font-bold mb-4">${t.personality_section}</h2>
                    <p class="text-gray-300 mb-6">${t.analysis_intro}</p>
                    <div class="bg-gradient-to-r from-gray-700 to-gray-900 p-6 rounded-lg mb-8">
                        <h3 class="text-2xl font-bold mb-2">${types[state.lang][primary]}</h3>
                        <p class="text-gray-200">${desc[state.lang][primary]}</p>
                    </div>
                    <div class="mt-8 text-center">
                        <button id="restartBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-6 rounded-lg mr-4">${t.restart_btn}</button>
                        <button id="copyBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">${t.copy_btn}</button>
                    </div>
                </div>
            </div>`;
            state.resultText = resultSummary;
            return resultSummary;
        }

        // ====== وظائف العرض ======
        function renderUserInfo() {
            const t = translations[state.lang];
            return `
            <div class="animate-fade-in text-center">
                <div class="glass-card rounded-xl p-8 max-w-3xl mx-auto">
                    <h1 class="text-4xl font-bold gradient-text mb-4">${t.welcome_title}</h1>
                    <p class="text-gray-300 text-lg mb-6">${t.user_info_desc}</p>
                    <div class="space-y-6 text-right">
                        <div><label class="block mb-2">${t.age_label}</label><input type="number" id="age" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600" /></div>
                        <div><label class="block mb-2">${t.gender_label}</label><select id="gender" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600"><option value="male">${t.male}</option><option value="female">${t.female}</option><option value="other">${t.other}</option></select></div>
                        <div><label class="block mb-2">${t.dob_label}</label><input type="date" id="dob" class="w-full p-3 rounded-lg bg-gray-800 border border-gray-600" /></div>
                        <button id="submitUserInfo" class="btn-primary">${t.submit_user_info}</button>
                    </div>
                </div>
            </div>`;
        }

        function renderIntro() {
            const t = translations[state.lang];
            return `
            <div class="animate-fade-in text-center">
                <div class="glass-card rounded-xl p-8 max-w-3xl mx-auto">
                    <h1 class="text-4xl font-bold gradient-text mb-4">${t.intro_title}</h1>
                    <p class="text-xl text-gray-300 mb-6">${t.intro_subtitle}</p>
                    <p class="text-gray-400 mb-4">${t.intro_desc}</p>
                    <div class="text-right text-gray-300 space-y-2 mb-6">
                        <p>• ${t.intro_p1}</p>
                        <p>• ${t.intro_p2}</p>
                    </div>
                    <button id="startBtn" class="btn-primary">${t.start_btn}</button>
                </div>
            </div>`;
        }

        function renderQuiz() {
            const q = questions[state.lang][state.currentQ];
            const progress = ((state.currentQ) / questions[state.lang].length * 100).toFixed(0);

            let optionsHTML = '';
            q.options.forEach((opt, idx) => {
                optionsHTML += `<div class="option-btn" onclick="selectAnswer(${idx})">${opt.text}</div>`;
            });

            return `
            <div class="animate-fade-in">
                <div class="progress-bar mb-6"><div class="progress-fill" style="width:${progress}%"></div></div>
                <div class="glass-card rounded-xl p-8 max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6">${q.text}</h2>
                    <div class="space-y-4">${optionsHTML}</div>
                    <button id="nextBtn" class="btn-primary mt-8">
                        ${state.currentQ === questions[state.lang].length - 1 ? 'عرض النتائج' : 'التالي'}
                    </button>
                </div>
            </div>`;
        }

        // ====== معالجة الأحداث ======
        function setupEventListeners() {
            document.addEventListener('click', (e) => {
                const t = translations[state.lang];
                if (e.target.id === 'submitUserInfo') {
                    const age = document.getElementById('age').value;
                    const gender = document.getElementById('gender').value;
                    const dob = document.getElementById('dob').value;
                    if (!age || !gender || !dob) return alert(t.alert_missing_fields);
                    state.userData = { age, gender, dob };
                    state.page = 'intro';
                    render();
                }
                if (e.target.id === 'startBtn') {
                    state.currentQ = 0;
                    state.userAnswers = Array(questions[state.lang].length).fill(null);
                    state.page = 'quiz';
                    render();
                }
                if (e.target.id === 'nextBtn') {
                    if (state.userAnswers[state.currentQ] === null) return alert(t.alert_no_answer);
                    if (state.currentQ < questions[state.lang].length - 1) {
                        state.currentQ++;
                        render();
                    } else {
                        state.page = 'result';
                        render();
                    }
                }
                if (e.target.id === 'restartBtn') {
                    state.page = 'userInfo';
                    state.userData = { age: null, gender: '', dob: '' };
                    state.currentQ = 0;
                    state.userAnswers = [];
                    render();
                }
                if (e.target.id === 'copyBtn') {
                    navigator.clipboard.writeText(state.resultText).then(() => {
                        showToast(t.alert_copied);
                    });
                }
                if (e.target.id === 'langToggle') {
                    state.lang = state.lang === 'ar' ? 'en' : 'ar';
                    render();
                }
            });
        }

        function selectAnswer(index) {
            state.userAnswers[state.currentQ] = index;
            document.querySelectorAll('.option-btn').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<div class="toast">${message}</div>`;
            setTimeout(() => toast.innerHTML = '', 3000);
        }

        // ====== العرض الرئيسي ======
        function render() {
            document.documentElement.lang = state.lang;
            document.documentElement.dir = state.lang === 'ar' ? 'rtl' : 'ltr';
            let html = `<div class="fixed top-4 ${state.lang === 'ar' ? 'left-4' : 'right-4'} z-50 flex space-x-2">
                <button id="langToggle" class="bg-yellow-400 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">${state.lang === 'ar' ? 'EN' : 'AR'}</button>
            </div>`;

            switch (state.page) {
                case 'userInfo': html += renderUserInfo(); break;
                case 'intro': html += renderIntro(); break;
                case 'quiz': html += renderQuiz(); break;
                case 'result': html += renderResult(); break;
            }

            html += `<footer class="mt-16 text-center text-gray-400 space-y-2 text-sm"><p class="font-semibold">${translations[state.lang].footer1}</p><p>${translations[state.lang].footer2}</p></footer>`;
            document.getElementById('app').innerHTML = html;
            setupEventListeners();
        }

        // ====== التهيئة ======
        document.addEventListener('DOMContentLoaded', () => {
            render();
        });
    </script>
</body>
</html>
